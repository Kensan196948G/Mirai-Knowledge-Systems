<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>検索結果詳細 - 建設土木ナレッジシステム</title>
    <link rel="stylesheet" href="styles.css?v=20260112154522" />
  </head>
  <body>
    <header class="header">
      <div class="brand reveal">
        <div class="brand-mark">MK</div>
        <div>
          <h1>Mirai Construction Knowledge</h1>
          <span>○○○○建設工業株式会社 技術本部 / 全支店・管轄施工現場</span>
        </div>
      </div>
      <nav class="top-nav reveal delay-1">
        <a href="index.html">現場ダッシュボード</a>
        <a href="#" onclick="openSearchModal(); return false;">ナレッジ検索</a>
        <a href="admin.html" data-required-role="admin">管理画面</a>
      </nav>
      <div class="header-actions reveal delay-2">
        <button class="icon-button-with-text" onclick="window.history.back()" title="戻る">
          ← 戻る
        </button>
        <button class="icon-button" onclick="openSearchModal()" title="高度な検索">
          🔍
        </button>
        <button class="icon-button notification-bell" onclick="openNotificationPanel()" title="通知">
          🔔
          <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
        </button>
        <button class="icon-button" onclick="openSettingsPanel()" title="設定">
          ⚙️
        </button>
        <span class="chip" id="viewCount">閲覧数 --</span>
        <span class="chip" id="lastSyncTime">最終同期 --:--</span>
        <button class="cta ghost" onclick="createNewKnowledge()" title="新規作成">+ 新規</button>
        <button class="cta" onclick="printPage()">印刷</button>
        <button class="cta secondary" onclick="exportPDF()">PDF出力</button>
      </div>
    </header>

    <main class="page">
      <!-- パンくずリスト -->
      <nav class="breadcrumb-nav-enhanced reveal" aria-label="パンくずリスト">
        <!-- 左側：ステータスバッジ -->
        <div class="breadcrumb-meta-left">
          <span class="status-badge" id="breadcrumbStatus">承認状態: 承認済み</span>
          <span class="priority-badge" id="breadcrumbPriority">優先度: 高</span>
        </div>

        <!-- 中央：パンくずリスト -->
        <ol class="breadcrumb-enhanced" id="breadcrumbList">
          <li>
            <span class="breadcrumb-icon">🏠</span>
            <a href="index.html">ホーム</a>
          </li>
          <li>
            <span class="breadcrumb-icon">🔍</span>
            <a href="index.html#search">検索結果</a>
          </li>
          <li class="breadcrumb-current" aria-current="page">
            <span class="breadcrumb-icon">📄</span>
            <span>詳細</span>
          </li>
        </ol>

        <!-- 右側：メタ情報 -->
        <div class="breadcrumb-meta-right">
          <span class="breadcrumb-info" id="breadcrumbCategory">📋 施工計画</span>
          <span class="breadcrumb-info" id="breadcrumbUpdated">📅 最終更新: 2026/01/07</span>
          <span class="breadcrumb-info" id="breadcrumbViews">👁️ 閲覧: 324回</span>
        </div>
      </nav>

      <aside class="sidebar reveal delay-1">
        <div class="nav-section">
          <div class="nav-title">ナビゲーション</div>
          <div class="nav-item">
            <a href="#overview"><strong>概要</strong></a>
            <span class="nav-meta" id="navSummaryInfo">--</span>
          </div>
          <div class="nav-item">
            <a href="#content"><strong>本文</strong></a>
            <span class="nav-meta" id="navContentInfo">--</span>
          </div>
          <div class="nav-item">
            <a href="#metadata"><strong>メタデータ</strong></a>
            <span class="nav-meta" id="navMetadataInfo">6項目</span>
          </div>
          <div class="nav-item">
            <a href="#history"><strong>編集履歴</strong></a>
            <span class="nav-meta" id="navHistoryInfo">--</span>
          </div>
          <div class="nav-item">
            <a href="#comments"><strong>コメント</strong></a>
            <span class="nav-meta" id="navCommentsInfo">0件</span>
          </div>
          <div class="nav-item">
            <a href="#related"><strong>関連ナレッジ</strong></a>
            <span class="nav-meta" id="navRelatedInfo">--</span>
          </div>
        </div>
        <div class="nav-section">
          <div class="nav-title">アクション</div>
          <button class="cta ghost" onclick="toggleBookmark()" id="bookmarkBtn">
            <span id="bookmarkIcon">☆</span> ブックマーク
          </button>
          <button class="cta ghost" onclick="toggleLike()" id="likeBtn">
            <span id="likeIcon">♡</span> いいね <span id="likeCount">0</span>
          </button>
          <button class="cta ghost" onclick="shareKnowledge()">
            🔗 共有
          </button>
        </div>
      </aside>

      <section class="main">
        <!-- ローディング表示 -->
        <div id="loadingIndicator" class="loading-overlay">
          <div class="loading-spinner"></div>
          <p>読み込み中...</p>
        </div>

        <!-- エラー表示 -->
        <div id="errorMessage" class="error-message" style="display: none;">
          <strong>エラー:</strong> <span id="errorText"></span>
          <button onclick="retryLoad()">再試行</button>
        </div>

        <!-- 詳細ヒーロー -->
        <section class="detail-hero reveal" id="overview">
          <h2 class="detail-title" id="knowledgeTitle">ナレッジタイトル</h2>
          <div class="meta-row" id="knowledgeMeta">
            <!-- 動的に挿入 -->
          </div>
          <div class="knowledge-tags" id="knowledgeTags">
            <!-- 動的に挿入 -->
          </div>
          <div class="cta-group">
            <button class="cta ghost" onclick="window.history.back()">← 戻る</button>
            <button class="cta secondary" onclick="editKnowledge()" data-required-role="construction_manager">編集</button>
            <button class="cta" onclick="submitDistribution('knowledge')">配信申請</button>
          </div>
        </section>

        <!-- 概要カード -->
        <section class="detail-grid reveal delay-1" id="content">
          <div class="detail-card">
            <h4>概要</h4>
            <div id="knowledgeSummary">
              <!-- 動的に挿入 -->
            </div>
          </div>

          <!-- 本文 -->
          <div class="detail-card" style="grid-column: 1 / -1;">
            <h4>本文</h4>
            <div id="knowledgeContent" class="knowledge-content">
              <!-- 動的に挿入 -->
            </div>
          </div>

          <!-- メタデータ -->
          <div class="detail-card" id="metadata">
            <h4>メタデータ</h4>
            <table class="table">
              <tbody id="metadataTable">
                <!-- 動的に挿入 -->
              </tbody>
            </table>
          </div>

          <!-- 添付ファイル -->
          <div class="detail-card" id="attachments">
            <h4>添付ファイル</h4>
            <div id="attachmentList">
              <!-- 動的に挿入 -->
            </div>
          </div>

          <!-- 編集履歴・バージョン -->
          <div class="detail-card" id="history" style="grid-column: 1 / -1;">
            <h4>編集履歴・バージョン</h4>
            <table class="table">
              <thead>
                <tr>
                  <th>バージョン</th>
                  <th>更新日時</th>
                  <th>編集者</th>
                  <th>変更内容</th>
                  <th>アクション</th>
                </tr>
              </thead>
              <tbody id="historyTable">
                <!-- 動的に挿入 -->
              </tbody>
            </table>
          </div>

          <!-- コメント機能 -->
          <div class="detail-card" id="comments" style="grid-column: 1 / -1;">
            <h4>コメント (<span id="commentCount">0</span>件)</h4>

            <!-- コメント入力フォーム -->
            <div class="comment-form" style="margin-bottom: 20px;">
              <textarea id="newComment" placeholder="コメントを入力..." rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
              <button class="cta" onclick="submitComment()" style="margin-top: 10px;">コメント投稿</button>
            </div>

            <!-- コメント一覧 -->
            <div id="commentList" class="comment-list">
              <!-- 動的に挿入 -->
            </div>
          </div>

          <!-- いいね・ブックマーク統計 -->
          <div class="detail-card">
            <h4>エンゲージメント</h4>
            <div class="stat-grid">
              <div class="stat-card">
                <div>いいね</div>
                <strong id="totalLikes">0</strong>
                <small>人が評価</small>
              </div>
              <div class="stat-card">
                <div>ブックマーク</div>
                <strong id="totalBookmarks">0</strong>
                <small>人が保存</small>
              </div>
              <div class="stat-card">
                <div>閲覧数</div>
                <strong id="totalViews">0</strong>
                <small>回</small>
              </div>
            </div>
          </div>
        </section>
      </section>

      <!-- 右サイドバー（関連ナレッジ） -->
      <aside class="rail reveal delay-1">
        <div>
          <h3 id="related">関連ナレッジ</h3>
          <div id="relatedKnowledgeList">
            <!-- 動的に挿入 -->
          </div>
        </div>

        <div style="margin-top: 30px;">
          <h3>タグクラウド</h3>
          <div id="tagCloud" class="tag-cloud" style="display: flex; flex-wrap: wrap; gap: 8px;">
            <!-- 動的に挿入 -->
          </div>
        </div>

        <div style="margin-top: 30px;">
          <h3>承認状況</h3>
          <div class="flow" id="approvalFlow">
            <!-- 動的に挿入 -->
          </div>
        </div>
      </aside>
    </main>

    <!-- 共有モーダル -->
    <div id="shareModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ナレッジを共有</h2>
          <button class="modal-close" onclick="closeShareModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="field">
            <label>共有URL</label>
            <div style="display: flex; gap: 10px;">
              <input type="text" id="shareUrl" readonly style="flex: 1;">
              <button class="cta" onclick="copyShareUrl()">コピー</button>
            </div>
          </div>
          <div class="field" style="margin-top: 20px;">
            <label>共有方法</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <button class="cta secondary" onclick="shareByEmail()">メール</button>
              <button class="cta secondary" onclick="shareBySlack()">Slack</button>
              <button class="cta secondary" onclick="shareByTeams()">Teams</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 編集モーダル -->
    <div id="editModal" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
          <h2>ナレッジ編集</h2>
          <button class="modal-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="editForm" onsubmit="saveKnowledgeEdit(event)">
            <div class="field">
              <label for="editTitle">タイトル <span style="color: red;">*</span></label>
              <input type="text" id="editTitle" required>
            </div>
            <div class="field">
              <label for="editCategory">カテゴリ</label>
              <select id="editCategory">
                <option value="安全管理">安全管理</option>
                <option value="品質管理">品質管理</option>
                <option value="施工管理">施工管理</option>
                <option value="環境管理">環境管理</option>
                <option value="技術資料">技術資料</option>
                <option value="その他">その他</option>
              </select>
            </div>
            <div class="field">
              <label for="editSummary">概要</label>
              <textarea id="editSummary" rows="3"></textarea>
            </div>
            <div class="field">
              <label for="editContent">本文 <span style="color: red;">*</span></label>
              <textarea id="editContent" rows="10" required></textarea>
            </div>
            <div class="field">
              <label for="editTags">タグ（カンマ区切り）</label>
              <input type="text" id="editTags" placeholder="例: 安全,作業手順,重機">
            </div>
            <div class="field">
              <label for="editProject">プロジェクト</label>
              <input type="text" id="editProject">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
              <button type="button" class="cta ghost" onclick="closeEditModal()">キャンセル</button>
              <button type="submit" class="cta">保存</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <button class="floating" onclick="scrollToTop()">↑ トップへ</button>

    <!-- Socket.IO Client Library (jsDelivr経由 - CSP対応) -->
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.2/dist/socket.io.min.js"></script>
    <script src="app.js?v=20260112130654"></script>
    <script src="dom-helpers.js?v=20260112130654"></script>
    <script src="detail-pages.js?v=20260112130654"></script>
    <script src="actions.js?v=20260112130654"></script>
  </body>
</html>
