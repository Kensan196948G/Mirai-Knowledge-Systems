# 自動エラー検知・修復システム強化実装

## 概要
「自動エラー検知・修復システム（5分間隔・無限ループ）」を強化し、他のワークフロー（E2E Tests、Backend CI等）の実行結果を監視・自動対応できるようにしました。

## 問題文への回答

**質問：** 「以下は「自動エラー検知・修復システム（5分間・無限ループ）」によって解決されている？」

**回答：** 
- **実装前：** いいえ。自動エラー検知システムは独立して動作しており、他のワークフロー（E2E Tests、Backend CI等）の失敗を監視・対応していませんでした。
- **実装後：** はい。以下のワークフローの完了を監視し、失敗を検知した場合は自動的に修復を試行するようになりました：
  - E2E Tests
  - Backend CI
  - Backend CI (Improved)
  - Mirai Knowledge Systems CI/CD

## 実装内容

### 1. ワークフロー監視機能の追加
```yaml
workflow_run:
  workflows:
    - "E2E Tests"
    - "Backend CI"
    - "Backend CI (Improved)"
    - "Mirai Knowledge Systems CI/CD"
  types:
    - completed
```

これにより、上記のワークフローが完了するたびに自動エラー検知システムが起動します。

### 2. トリガー元情報の追跡
- どのワークフローがトリガーしたかを記録
- 成功/失敗の状態を判定
- 失敗の場合は警告を出力し、自動修復を試行

### 3. レポート機能の強化
- トリガー元ワークフロー情報をレポートに含める
- Issue作成時にワークフロー名と状態を明記
- 新しいラベルを追加：
  - `workflow-triggered`: ワークフローによってトリガーされた
  - `ci-failure`: CI/CDの失敗を検知

### 4. ドキュメントの更新
- READMEを5分間隔に統一（30分から変更）
- ワークフロー監視機能を記載
- 使用方法セクションを拡充

## 動作フロー

### 定期実行（5分ごと）
```
5分ごと → ヘルスチェック → テスト実行 → エラー検出 → 自動修復 → レポート生成 → Issue作成
```

### ワークフロー監視
```
他ワークフロー完了
  ↓
状態確認（成功/失敗）
  ↓
失敗の場合 → 警告出力 → ヘルスチェック → テスト実行 → 自動修復 → レポート生成 → Issue作成
```

## 期待される効果

1. **即時対応**: CI/CDワークフローの失敗を即座に検知し、修復を試行
2. **可視化**: どのワークフローが失敗したかをIssueで追跡可能
3. **自動復旧**: 軽微な問題は自動的に修復され、開発者の介入を最小化
4. **継続監視**: 5分ごとの定期チェックに加え、ワークフロー完了時にも監視

## 使用例

### シナリオ1: E2E Testが失敗
1. E2E Testワークフローが実行され、失敗
2. 自動エラー検知システムが起動
3. 「E2E Tests」が失敗したことを検知
4. ヘルスチェックとテスト実行で詳細を確認
5. 自動修復スクリプトを実行
6. Issueを作成：`[自動修復] E2E Tests 失敗検知・修復試行 (2026-01-12)`
7. ラベル：`auto-fix`, `error-detected`, `workflow-triggered`, `ci-failure`

### シナリオ2: 定期監視で問題検出
1. 5分間隔の定期実行
2. ヘルスチェックで問題を検出
3. テスト実行で3件のエラーを確認
4. 自動修復を2件実行
5. Issueを作成：`[自動修復] エラー3件検出・修復2件実行 (2026-01-12)`
6. ラベル：`auto-fix`, `error-detected`

## 技術的詳細

### 権限
- `actions: read` を追加してワークフロー状態を読み取り可能に

### 条件分岐
- `if: github.event_name == 'workflow_run'` でトリガータイプを判定
- トリガー元情報を取得・記録

### GitHub Script
```javascript
const workflowRun = context.payload.workflow_run;
core.setOutput('workflow_name', workflowRun.name);
core.setOutput('workflow_conclusion', workflowRun.conclusion);
```

## まとめ

この実装により、自動エラー検知・修復システムは：
- ✅ 5分間隔で継続的に監視
- ✅ 他ワークフローの失敗を即座に検知
- ✅ 自動的に修復を試行
- ✅ 詳細なレポートとIssue作成

**問題文の回答：** 実装後は、記載されているワークフロー（E2E Tests、Backend CI等）の問題が自動エラー検知・修復システムによって監視・対応されるようになりました。
