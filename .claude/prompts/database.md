# データベース操作用プロンプト

## セッション開始時に使用

```
以降、日本語で対応願います。

## データベース情報
- DBMS: PostgreSQL 16.11
- データベース名: mirai_knowledge_db
- スキーマ: public, auth, audit
- 接続: localhost:5432

## 操作ルール
1. 本番データ操作前にバックアップ必須
2. DELETE/UPDATEはWHERE句必須
3. TRUNCATE禁止（DELETEを使用）
4. 大量データ操作はバッチ処理

## 禁止事項
- DROP DATABASE
- DROP SCHEMA CASCADE
- TRUNCATE
- パスワードハッシュの直接変更

## 今回の作業
[ここに具体的な作業内容を記載]
```

## マイグレーション作業

### Alembicマイグレーション
```
Alembicマイグレーションを作成・実行してください。

変更内容:
- [テーブル/カラムの変更内容]

手順：
1. alembic revision --autogenerate -m "変更内容"
2. マイグレーションファイル確認
3. alembic upgrade head
4. 確認クエリ実行
```

### 手動スキーマ変更
```
以下のスキーマ変更を実行してください：

変更内容: [変更の詳細]

手順：
1. バックアップ取得
2. 変更SQLの確認
3. トランザクション内で実行
4. 検証クエリ実行
5. init-db.sql更新
```

## データ移行

### JSONからPostgreSQL
```
JSONデータをPostgreSQLに移行してください。

ソース: backend/data/[ファイル名].json
ターゲット: [テーブル名]

手順：
1. 既存スクリプト確認: scripts/migrate_json_to_postgres.py
2. データ形式確認
3. 移行実行
4. 件数・整合性確認
```

### 外部データインポート
```
外部ソースからデータをインポートしてください。

ソース: [ファイル/URL]
形式: [CSV/JSON/Excel]
ターゲット: [テーブル名]

手順：
1. データ形式分析
2. インポートスクリプト作成
3. テスト環境で検証
4. 本番インポート
```

## バックアップ・リストア

### バックアップ取得
```
データベースのバックアップを取得してください。

pg_dump -h localhost -U postgres -d mirai_knowledge_db -F c -f backup_$(date +%Y%m%d).dump
```

### リストア
```
バックアップからリストアしてください。

対象: [バックアップファイル]

手順：
1. 現在のDB状態確認
2. 必要に応じて既存データ削除
3. リストア実行
4. 検証
```

## クエリ最適化
```
以下のクエリを最適化してください：

クエリ: [最適化対象のクエリ]

確認項目：
1. EXPLAIN ANALYZE実行
2. インデックス使用状況
3. クエリプラン分析
4. 改善案提示
```
