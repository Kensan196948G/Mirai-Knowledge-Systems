# WebUI包括的テスト計画書

## 1. 概要

- **機能名**: Mirai Knowledge Systems - WebUIフロントエンド
- **テスト対象**: ログイン、MFA、MS365同期、リアルタイム通知、PWAオフライン対応
- **テスト担当者**: test-designer SubAgent
- **テスト期間**: 2026-02-10〜2026-02-17
- **バージョン**: v1.4.0

## 2. テスト戦略

### 2.1 テストレベル

| レベル | 対象 | ツール | カバレッジ目標 |
|--------|------|--------|---------------|
| E2Eテスト | ユーザーシナリオ全体 | Playwright | 主要シナリオ100% |
| 統合テスト | API連携・WebSocket | Playwright | 80% |
| ユニットテスト | 個別JS関数 | Jest | 85% |

### 2.2 テスト環境

- **OS**: Linux (Ubuntu 24.04) / Windows 11
- **ブラウザ**: Chrome 120+, Firefox 120+, Safari 17+, Edge 120+
- **デバイス**: Desktop (1920x1080), Tablet (768x1024), Mobile (375x667)
- **ネットワーク**: Online, Offline, Slow 3G
- **Database**: JSON（開発環境）
- **Port**: 5200 (HTTP) / 5243 (HTTPS)

## 3. テスト観点

### 3.1 機能テスト

| カテゴリ | 正常系 | 異常系 | 境界値 | 権限 | 合計 |
|---------|-------|-------|-------|------|------|
| ログイン | 8件 | 12件 | 6件 | 4件 | 30件 |
| MFA設定 | 10件 | 15件 | 8件 | 6件 | 39件 |
| MS365同期 | 12件 | 18件 | 10件 | 8件 | 48件 |
| リアルタイム通知 | 15件 | 20件 | 8件 | 10件 | 53件 |
| PWAオフライン | 20件 | 25件 | 12件 | 8件 | 65件 |
| **合計** | **65件** | **90件** | **44件** | **36件** | **235件** |

### 3.2 非機能テスト

| 観点 | 目標 | 測定方法 |
|------|------|----------|
| パフォーマンス | 初回読み込み≤3秒、ページ遷移≤1秒 | Lighthouse |
| セキュリティ | XSS/CSRF対策100%、トークン暗号化 | OWASP ZAPスキャン |
| アクセシビリティ | WCAG 2.1 AA準拠（スコア≥90） | axe DevTools |
| PWA適合性 | Lighthouse PWAスコア≥85 | Lighthouse |
| オフライン動作 | 主要機能70%以上オフライン対応 | 手動検証 |
| レスポンシブ | 320px〜2560px全対応 | BrowserStack |

## 4. テストデータ

### 4.1 準備データ

#### ユーザーアカウント（6種類）

```json
{
  "admin_no_mfa": {
    "email": "admin@example.com",
    "password": "Admin1234!",
    "role": "admin",
    "mfa_enabled": false
  },
  "admin_with_mfa": {
    "email": "admin_mfa@example.com",
    "password": "Admin1234!",
    "role": "admin",
    "mfa_enabled": true,
    "totp_secret": "JBSWY3DPEHPK3PXP"
  },
  "editor": {
    "email": "editor@example.com",
    "password": "Editor1234!",
    "role": "editor",
    "mfa_enabled": false
  },
  "viewer": {
    "email": "viewer@example.com",
    "password": "Viewer1234!",
    "role": "viewer",
    "mfa_enabled": false
  },
  "suspended": {
    "email": "suspended@example.com",
    "password": "Suspended1234!",
    "role": "viewer",
    "status": "suspended"
  },
  "expired_token": {
    "email": "expired@example.com",
    "password": "Expired1234!",
    "token_expires_at": "2024-01-01T00:00:00Z"
  }
}
```

#### ナレッジデータ（20件）

- カテゴリ別: 技術（8件）、安全（6件）、法規（6件）
- ステータス: 承認済み（15件）、承認待ち（3件）、下書き（2件）
- 添付ファイル: PDF（5件）、Word（3件）、Excel（2件）

#### 通知データ（30件）

- タイプ別:
  - approval_required（承認依頼）: 10件
  - approval_completed（承認完了）: 8件
  - incident_reported（事故報告）: 7件
  - consultation_answered（相談回答）: 5件
- ステータス: 未読（20件）、既読（10件）

#### MS365同期設定（5件）

- OneDrive同期（有効・1時間ごと）
- SharePoint同期（無効・手動）
- エラー状態の同期（再試行待ち）
- 大量ファイル同期（100ファイル）
- 空フォルダ同期

### 4.2 テスト後のクリーンアップ

```javascript
// テスト後処理
afterEach(async ({ page, context }) => {
  // LocalStorage/SessionStorage/IndexedDBクリア
  await page.evaluate(() => {
    localStorage.clear();
    sessionStorage.clear();
    indexedDB.databases().then(dbs => {
      dbs.forEach(db => indexedDB.deleteDatabase(db.name));
    });
  });

  // Service Workerアンレジスター
  await page.evaluate(() => {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(r => r.unregister());
      });
    }
  });

  // キャッシュクリア
  await page.evaluate(() => {
    caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
  });

  // Cookieクリア
  await context.clearCookies();
});
```

## 5. テストケース詳細

### 5.1 ログイン機能（30件）

#### 正常系（8件）

- **TC-L-001**: 有効な認証情報でログイン成功
- **TC-L-002**: ログイン後、LocalStorageにトークン保存確認
- **TC-L-003**: ログイン後、ダッシュボードへリダイレクト
- **TC-L-004**: ログアウト後、トークン削除とログインページ遷移
- **TC-L-005**: ページリロード後もセッション維持（トークン有効時）
- **TC-L-006**: Remember Meチェックで長期セッション
- **TC-L-007**: 複数タブで同時ログイン動作
- **TC-L-008**: ログイン成功時の監査ログ記録

#### 異常系（12件）

- **TC-L-101**: 無効なユーザー名でログイン失敗
- **TC-L-102**: 無効なパスワードでログイン失敗
- **TC-L-103**: 空のユーザー名でバリデーションエラー
- **TC-L-104**: 空のパスワードでバリデーションエラー
- **TC-L-105**: 連続5回失敗後、アカウントロック（Rate Limiting）
- **TC-L-106**: XSS攻撃ペイロード入力で無害化
- **TC-L-107**: SQLインジェクション試行で拒否
- **TC-L-108**: CSRF攻撃で拒否（トークン検証）
- **TC-L-109**: 停止アカウントでログイン拒否
- **TC-L-110**: 期限切れトークンで自動ログアウト
- **TC-L-111**: ネットワークエラー時のエラー表示
- **TC-L-112**: サーバー500エラー時のフォールバック表示

#### 境界値（6件）

- **TC-L-201**: ユーザー名1文字（最小値）
- **TC-L-202**: ユーザー名255文字（最大値）
- **TC-L-203**: パスワード8文字（最小値）
- **TC-L-204**: パスワード128文字（最大値）
- **TC-L-205**: パスワードに特殊文字全種類
- **TC-L-206**: ユニコード文字（日本語・絵文字）入力

#### 権限テスト（4件）

- **TC-L-301**: 未認証で保護ページアクセス→ログインページリダイレクト
- **TC-L-302**: Admin権限で管理画面アクセス成功
- **TC-L-303**: Editor権限で管理画面アクセス拒否（403）
- **TC-L-304**: Viewer権限で読み取り専用動作確認

---

### 5.2 MFA設定フロー（39件）

#### 正常系（10件）

- **TC-M-001**: MFAセットアップウィザード完全フロー
  - Step 1: QRコード表示
  - Step 2: TOTP検証成功
  - Step 3: バックアップコード10個表示
- **TC-M-002**: QRコード画像が有効なBase64形式
- **TC-M-003**: シークレットキー32文字表示
- **TC-M-004**: TOTP6桁入力で自動サブミット
- **TC-M-005**: バックアップコード保存確認チェックボックス
- **TC-M-006**: MFA有効化後のステータス更新
- **TC-M-007**: MFAログイン時のカウントダウンタイマー表示
- **TC-M-008**: バックアップコード使用でログイン成功（1回限り）
- **TC-M-009**: MFA無効化の確認モーダル表示
- **TC-M-010**: バックアップコード再生成で新規10個発行

#### 異常系（15件）

- **TC-M-101**: 無効なTOTPコード（000000）で検証失敗
- **TC-M-102**: 期限切れTOTPコード（±60秒外）で失敗
- **TC-M-103**: 5回連続失敗でRate Limiting発動（15分ロック）
- **TC-M-104**: 使用済みバックアップコードで再ログイン失敗
- **TC-M-105**: MFAトークン期限切れ（5分）でタイムアウト
- **TC-M-106**: QRコード生成失敗時のエラー表示
- **TC-M-107**: 未認証でMFAセットアップページアクセス拒否
- **TC-M-108**: MFA既有効時のセットアップページアクセス拒否
- **TC-M-109**: ネットワークエラー時のリトライUI表示
- **TC-M-110**: MFA無効化時のパスワード入力誤り
- **TC-M-111**: MFA無効化時のTOTP入力誤り
- **TC-M-112**: バックアップコード形式違反（AAAA-1111-BBBB以外）
- **TC-M-113**: 連続バックアップコード再生成で制限
- **TC-M-114**: 他人のMFA設定ページアクセス拒否（IDOR）
- **TC-M-115**: XSS攻撃でQRコード改ざん試行を防止

#### 境界値（8件）

- **TC-M-201**: TOTP 6桁未満入力で無効化
- **TC-M-202**: TOTP 7桁以上入力でトリミング
- **TC-M-203**: バックアップコード全10個使い切った状態
- **TC-M-204**: MFAカウントダウン0秒でタイムアウト処理
- **TC-M-205**: QRコード画像サイズ上限テスト
- **TC-M-206**: 同時複数デバイスでMFAセットアップ試行
- **TC-M-207**: ブラウザリロード時のセットアップ状態保持
- **TC-M-208**: MFA設定画面で戻るボタン押下時の確認ダイアログ

#### 権限テスト（6件）

- **TC-M-301**: 未認証ユーザーはMFA設定不可
- **TC-M-302**: 自己アカウントのMFA管理のみ可能
- **TC-M-303**: Admin権限でも他人のMFA強制無効化不可
- **TC-M-304**: Viewer権限でもMFA自己設定可能
- **TC-M-305**: MFA有効ユーザーのみバックアップコード再生成可
- **TC-M-306**: 停止アカウントはMFA設定変更不可

---

### 5.3 MS365同期設定（48件）

#### 正常系（12件）

- **TC-MS-001**: MS365同期設定一覧表示
- **TC-MS-002**: 新規OneDrive同期設定作成
- **TC-MS-003**: SharePoint同期設定編集
- **TC-MS-004**: 同期設定削除の確認ダイアログ
- **TC-MS-005**: 手動同期トリガー実行成功
- **TC-MS-006**: 接続テスト（ドライラン）成功表示
- **TC-MS-007**: cron形式入力→日本語変換表示（例: "毎日午前9時"）
- **TC-MS-008**: 同期履歴10件表示（ページネーション）
- **TC-MS-009**: 同期成功時のステータス更新とタイムスタンプ
- **TC-MS-010**: エラー詳細モーダル表示
- **TC-MS-011**: 同期中のプログレスバー表示
- **TC-MS-012**: 統計情報リアルタイム更新（成功率、ファイル数）

#### 異常系（18件）

- **TC-MS-101**: 無効なcron形式入力でバリデーションエラー
- **TC-MS-102**: MS365認証失敗時のエラー表示
- **TC-MS-103**: ネットワークタイムアウトでリトライUI
- **TC-MS-104**: 同期中の重複実行防止
- **TC-MS-105**: 大量ファイル同期時のメモリリーク検証
- **TC-MS-106**: 接続テスト失敗時の詳細エラーメッセージ
- **TC-MS-107**: 存在しないフォルダパス指定でエラー
- **TC-MS-108**: 権限不足でSharePointアクセス拒否
- **TC-MS-109**: MS365 APIレート制限到達時の429エラー処理
- **TC-MS-110**: 無効な同期設定IDでAPI呼び出しエラー
- **TC-MS-111**: 削除済み同期設定の再アクセス防止
- **TC-MS-112**: XSS攻撃で同期設定名改ざん試行防止
- **TC-MS-113**: SQLインジェクション試行でフィルター防御
- **TC-MS-114**: CSRF攻撃で設定変更試行を防止
- **TC-MS-115**: 同期履歴の不正ページ番号指定でエラー
- **TC-MS-116**: 同時複数ユーザーの同期競合処理
- **TC-MS-117**: ブラウザクラッシュ後の同期状態復旧
- **TC-MS-118**: オフライン時の同期設定変更キュー保存

#### 境界値（10件）

- **TC-MS-201**: 同期設定名1文字（最小値）
- **TC-MS-202**: 同期設定名255文字（最大値）
- **TC-MS-203**: フォルダパス1文字
- **TC-MS-204**: フォルダパス1024文字（最大値）
- **TC-MS-205**: cron最短間隔（1分ごと）
- **TC-MS-206**: cron最長間隔（月1回）
- **TC-MS-207**: 同期履歴0件の空状態表示
- **TC-MS-208**: 同期履歴10,000件の大量データ表示
- **TC-MS-209**: 同期ファイル数0件（空フォルダ）
- **TC-MS-210**: 同期ファイル数1,000件（大量ファイル）

#### 権限テスト（8件）

- **TC-MS-301**: 未認証でMS365設定ページアクセス拒否
- **TC-MS-302**: Admin権限で全設定CRUD可能
- **TC-MS-303**: Editor権限で読み取り専用（編集不可）
- **TC-MS-304**: Viewer権限でアクセス拒否（403）
- **TC-MS-305**: 自己設定のみ編集可能（他人設定は読み取りのみ）
- **TC-MS-306**: 停止アカウントは同期設定変更不可
- **TC-MS-307**: MS365権限（ms365_sync.execute）なしで実行不可
- **TC-MS-308**: 監査ログに全操作記録確認

---

### 5.4 リアルタイム通知（53件）

#### 正常系（15件）

- **TC-N-001**: ページロード時の未読通知数バッジ表示
- **TC-N-002**: 通知パネルクリックでドロップダウン表示
- **TC-N-003**: 通知一覧取得と表示（最新20件）
- **TC-N-004**: 未読通知の視覚的ハイライト表示
- **TC-N-005**: 通知クリックで既読マーク自動更新
- **TC-N-006**: 通知タイプ別アイコン表示（📋✅⚠️💬）
- **TC-N-007**: タイムスタンプの相対時刻表示（"2分前"）
- **TC-N-008**: "すべて既読"ボタンでバッチ既読化
- **TC-N-009**: フィルター: "未読のみ"表示切り替え
- **TC-N-010**: フィルター: "既読のみ"表示切り替え
- **TC-N-011**: フィルター: "すべて"表示切り替え
- **TC-N-012**: 通知リンクから対象ナレッジへ遷移
- **TC-N-013**: リアルタイム通知受信時のバッジ更新（WebSocket）
- **TC-N-014**: 新規通知時のトースト通知表示
- **TC-N-015**: 通知パネル外クリックで自動クローズ

#### 異常系（20件）

- **TC-N-101**: 通知API障害時のエラートースト表示
- **TC-N-102**: WebSocket切断時の再接続リトライ（3回）
- **TC-N-103**: 認証エラーでWebSocket接続失敗
- **TC-N-104**: 通知0件の空状態表示
- **TC-N-105**: 無効な通知IDで既読API呼び出しエラー
- **TC-N-106**: ネットワークタイムアウトで既読化失敗
- **TC-N-107**: 削除済み通知の表示防止
- **TC-N-108**: 不正なフィルター値でAPIエラー
- **TC-N-109**: XSS攻撃で通知内容改ざん試行防止
- **TC-N-110**: HTMLインジェクションで通知表示破壊防止
- **TC-N-111**: 通知バッジオーバーフロー（99+表示）
- **TC-N-112**: 同時複数通知受信時の重複防止
- **TC-N-113**: ブラウザ通知権限拒否時のフォールバック
- **TC-N-114**: トースト通知の重ね表示制限（最大5件）
- **TC-N-115**: 長文通知の省略表示（"...続きを読む"）
- **TC-N-116**: 通知パネルスクロール位置保持
- **TC-N-117**: 通知受信時のサウンド再生エラー処理
- **TC-N-118**: オフライン時の通知キュー保存
- **TC-N-119**: 通知APIレート制限（1秒10件）超過時の429処理
- **TC-N-120**: 通知削除API未実装時の非表示処理

#### 境界値（8件）

- **TC-N-201**: 通知0件の初期状態
- **TC-N-202**: 通知1件の単一表示
- **TC-N-203**: 通知100件の大量表示（ページネーション）
- **TC-N-204**: 通知バッジ99+表示（100件以上）
- **TC-N-205**: 通知内容1文字（最小値）
- **TC-N-206**: 通知内容1000文字（最大値、省略表示）
- **TC-N-207**: WebSocket再接続間隔（1秒→2秒→4秒→失敗）
- **TC-N-208**: トースト通知表示時間（3秒→自動消失）

#### 権限テスト（10件）

- **TC-N-301**: 未認証で通知API呼び出し拒否（401）
- **TC-N-302**: 自己通知のみ取得可能（他人通知は不可）
- **TC-N-303**: Admin権限で全通知閲覧可能
- **TC-N-304**: Editor権限で自己通知のみ
- **TC-N-305**: Viewer権限で読み取り専用通知
- **TC-N-306**: 承認権限なしで承認通知受信不可
- **TC-N-307**: 事故報告権限なしで事故通知受信不可
- **TC-N-308**: WebSocket接続時の認証トークン検証
- **TC-N-309**: 停止アカウントは通知受信停止
- **TC-N-310**: 通知設定のオプトアウト動作確認

---

### 5.5 PWAオフライン対応（65件）

#### 正常系（20件）

- **TC-P-001**: Service Worker登録成功確認
- **TC-P-002**: Service Workerバージョン確認（v1.3.0）
- **TC-P-003**: Web App Manifest読み込み成功
- **TC-P-004**: Manifest内容検証（name, icons, theme_color）
- **TC-P-005**: オフラインページ表示確認
- **TC-P-006**: 静的アセットキャッシュ（HTML/CSS/JS）
- **TC-P-007**: APIレスポンスキャッシュ（検索結果1時間）
- **TC-P-008**: オフライン時のフォールバックページ表示
- **TC-P-009**: ネットワーク復旧時の自動同期
- **TC-P-010**: IndexedDB暗号化トークン保存
- **TC-P-011**: CryptoHelper暗号化/復号化動作
- **TC-P-012**: CacheManager LRU削除（45MB閾値）
- **TC-P-013**: SyncManager Background Sync登録
- **TC-P-014**: InstallPromptManagerインストールバナー表示
- **TC-P-015**: PWAホーム画面インストール成功（Android）
- **TC-P-016**: PWAスタンドアロンモード起動
- **TC-P-017**: レスポンシブデザイン（320px〜2560px）
- **TC-P-018**: ハンバーガーメニュー表示（モバイル）
- **TC-P-019**: オフラインインジケーター表示/非表示
- **TC-P-020**: Service Worker自動更新（24時間後）

#### 異常系（25件）

- **TC-P-101**: Service Worker登録失敗時のフォールバック
- **TC-P-102**: Manifest読み込み404エラー処理
- **TC-P-103**: オフライン時のAPI呼び出しエラー表示
- **TC-P-104**: キャッシュ容量超過（50MB）で古いキャッシュ削除
- **TC-P-105**: IndexedDB接続失敗時のフォールバック
- **TC-P-106**: 暗号化鍵導出失敗時のエラー処理
- **TC-P-107**: 復号化失敗時のトークン削除とログアウト
- **TC-P-108**: Background Sync未対応ブラウザの即座同期
- **TC-P-109**: インストールプロンプト拒否時の7日クールダウン
- **TC-P-110**: オフライン時のフォーム送信キュー保存
- **TC-P-111**: キュー送信失敗時の指数バックオフリトライ
- **TC-P-112**: Service Workerクラッシュ時の自動再起動
- **TC-P-113**: キャッシュ破損時の再取得処理
- **TC-P-114**: 古いService Workerの自動削除
- **TC-P-115**: 複数タブでのService Worker競合解決
- **TC-P-116**: オフライン時のWebSocket再接続失敗
- **TC-P-117**: PWAアイコン404エラーのフォールバック
- **TC-P-118**: HTTPSなしのPWA機能制限警告
- **TC-P-119**: ストレージ容量不足時の警告表示
- **TC-P-120**: Service Worker更新失敗時のロールバック
- **TC-P-121**: オフライン時の画像読み込み失敗の代替表示
- **TC-P-122**: キャッシュミス時のオフラインページ表示
- **TC-P-123**: ネットワークタイムアウト（30秒）でキャッシュ優先
- **TC-P-124**: Safari/iOSのService Worker制限対応
- **TC-P-125**: プライベートブラウジングでのIndexedDB制限

#### 境界値（12件）

- **TC-P-201**: キャッシュサイズ0MB（初期状態）
- **TC-P-202**: キャッシュサイズ45MB（削除開始閾値）
- **TC-P-203**: キャッシュサイズ50MB（最大容量）
- **TC-P-204**: IndexedDBトークン有効期限0秒（即削除）
- **TC-P-205**: IndexedDBトークン有効期限24時間（最長）
- **TC-P-206**: 同期キュー0件（空状態）
- **TC-P-207**: 同期キュー100件（大量キュー）
- **TC-P-208**: Background Syncリトライ1回目（1秒待機）
- **TC-P-209**: Background Syncリトライ5回目（16秒待機→失敗）
- **TC-P-210**: Service Workerバージョン差分更新
- **TC-P-211**: PWAインストールバナー2分後表示
- **TC-P-212**: PWAインストールバナー3ページ閲覧後表示

#### 権限テスト（8件）

- **TC-P-301**: 未認証でオフラインページアクセス可能
- **TC-P-302**: Service Workerは全ユーザー共通（権限なし）
- **TC-P-303**: IndexedDB暗号化トークンは他ユーザー読取不可
- **TC-P-304**: ブラウザ通知権限要求ダイアログ表示
- **TC-P-305**: 位置情報権限不要の確認
- **TC-P-306**: カメラ/マイク権限不要の確認
- **TC-P-307**: ストレージ権限（Persistent Storage）要求
- **TC-P-308**: Service Worker更新は管理者権限不要

---

## 6. 成功基準

### 6.1 定量基準

| 指標 | 目標 | 現状 | 判定 |
|------|------|------|------|
| テスト実行率 | 100% | - | - |
| 成功率 | ≥95% | - | - |
| コードカバレッジ（E2E） | ≥80% | - | - |
| コードカバレッジ（Unit） | ≥85% | - | - |
| パフォーマンス（Lighthouse） | ≥90 | - | - |
| アクセシビリティ（axe） | ≥90 | - | - |
| PWAスコア（Lighthouse） | ≥85 | - | - |
| セキュリティスキャン（ZAP） | 0 Critical | - | - |

### 6.2 定性基準

- [ ] 全ブラウザで主要機能動作確認
- [ ] レスポンシブデザイン全デバイス対応
- [ ] オフライン時の主要機能70%利用可能
- [ ] XSS/CSRF攻撃耐性確認
- [ ] Rate Limiting動作確認
- [ ] 監査ログ記録確認
- [ ] エラーハンドリング全パターン動作確認
- [ ] ユーザビリティ問題なし

## 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| テストデータ準備遅延 | 中 | 低 | Fixtureスクリプト事前準備、モックAPI活用 |
| 環境構築失敗 | 高 | 低 | Docker環境使用、CI/CD自動化 |
| ブラウザ依存不具合 | 中 | 中 | BrowserStack活用、主要3ブラウザ優先 |
| WebSocket接続不安定 | 中 | 中 | リトライロジック実装、フォールバックポーリング |
| Service Worker更新タイミング | 低 | 中 | 強制アンレジスター、ハードリフレッシュ手順 |
| オフラインテスト困難 | 中 | 中 | Playwright Offline Context活用 |
| セキュリティスキャン誤検知 | 低 | 高 | 手動検証、ホワイトリスト管理 |

## 8. テスト実行計画

### 8.1 実行スケジュール

| フェーズ | 期間 | 内容 | 担当 |
|---------|------|------|------|
| Phase 1: テストケース実装 | Day 1-2 | Playwright/Jestテストコード作成 | test-designer |
| Phase 2: ローカル実行 | Day 3 | 開発環境でテスト実行・デバッグ | test-designer |
| Phase 3: CI統合 | Day 4 | GitHub Actions統合、自動実行設定 | ci-specialist |
| Phase 4: レビュー | Day 5 | テストレビュー、カバレッジ確認 | test-reviewer |
| Phase 5: 本番環境テスト | Day 6-7 | 本番環境でリグレッションテスト | QA Team |

### 8.2 実行コマンド

```bash
# E2Eテスト（Playwright）
cd /mnt/d/Mirai-Knowledge-Systems/backend
npm run test:e2e

# 特定機能のみテスト
npm run test:e2e -- login.spec.js
npm run test:e2e -- mfa-flow.spec.js
npm run test:e2e -- pwa-functionality.spec.js
npm run test:e2e -- ms365-integration.spec.js
npm run test:e2e -- notifications.spec.js

# ユニットテスト（Jest）
npm run test:unit

# カバレッジ付きテスト
npm run test:coverage

# セキュリティスキャン
npm run test:security

# パフォーマンステスト
npm run test:lighthouse
```

## 9. 成果物

### 9.1 テストコード

- `backend/tests/e2e/webui-login-comprehensive.spec.js`（ログイン30件）
- `backend/tests/e2e/webui-mfa-comprehensive.spec.js`（MFA39件）
- `backend/tests/e2e/webui-ms365-comprehensive.spec.js`（MS365 48件）
- `backend/tests/e2e/webui-notifications-comprehensive.spec.js`（通知53件）
- `backend/tests/e2e/webui-pwa-comprehensive.spec.js`（PWA65件）

### 9.2 テストレポート

- `tests/reports/webui_test_execution_report.html`（実行レポート）
- `tests/reports/webui_test_coverage_report.html`（カバレッジレポート）
- `tests/reports/webui_lighthouse_report.html`（Lighthouseレポート）
- `tests/reports/webui_security_scan_report.html`（セキュリティスキャンレポート）

### 9.3 ドキュメント

- `tests/webui_test_plan.md`（本ドキュメント）
- `tests/webui_test_cases.md`（詳細テストケース）
- `tests/webui_test_fixtures.md`（Fixtureデータ定義）
- `tests/webui_test_report.md`（最終テスト報告書）

## 10. レビュー観点（test-reviewer向け）

### 10.1 テストケース網羅性

- [ ] 正常系・異常系・境界値・権限テストすべてカバー
- [ ] エッジケース（オフライン、タイムアウト、競合）考慮
- [ ] クロスブラウザ・レスポンシブ対応確認

### 10.2 テストコード品質

- [ ] DRY原則（共通処理のHelper関数化）
- [ ] 明確なテストケース名（TC-XXX-001形式）
- [ ] アサーション適切（expect文の数と内容）
- [ ] テストデータのクリーンアップ実装

### 10.3 セキュリティテスト

- [ ] XSS/CSRF/SQLインジェクション対策確認
- [ ] Rate Limiting動作確認
- [ ] 権限テスト全ロール実施
- [ ] 監査ログ記録確認

### 10.4 パフォーマンステスト

- [ ] ページロード時間測定
- [ ] API応答時間測定
- [ ] メモリリークチェック
- [ ] 大量データ処理確認

## 11. 次のステップ

1. test-reviewer による本テスト計画のレビュー
2. テストケース実装（test-designer）
3. CI統合（ci-specialist）
4. 実行とデバッグ
5. テスト報告書作成

---

**作成日**: 2026-02-10
**作成者**: test-designer SubAgent
**バージョン**: v1.0
**ステータス**: レビュー待ち
