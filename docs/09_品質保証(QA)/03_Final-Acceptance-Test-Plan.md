# 最終受入テスト計画書
## Mirai Knowledge Systems - Final Acceptance Test Plan

**バージョン:** 1.0
**作成日:** 2025-12-27
**ステータス:** 承認待ち

---

## 1. テスト目的とスコープ

### 1.1 テスト目的
本最終受入テストは、Mirai Knowledge Systemsが本番環境での運用に耐えうる品質を有していることを確認し、以下を保証することを目的とする：

- 全機能要件が仕様通りに動作すること
- 非機能要件（性能、セキュリティ、可用性）が満たされていること
- エンドツーエンドの業務フローが正常に完結すること
- 実運用環境での安定稼働が可能であること

### 1.2 テストスコープ

#### 対象範囲
- 全機能モジュール（フェーズA〜B-9まで）
- API層（FastAPI）
- データベース層（PostgreSQL）
- フロントエンド（HTML/JavaScript）
- 統合機能（検索、通知、承認フロー）
- セキュリティ機能（認証、認可、暗号化）

#### 対象外
- 第三者ライブラリの内部動作
- インフラストラクチャの詳細設定（OS、ネットワーク機器等）
- 外部システムとの連携（将来実装予定機能）

---

## 2. 受入基準

### 2.1 機能要件
- **全機能動作確認:** 全ての実装済み機能が仕様書通りに動作すること
- **エラーハンドリング:** 異常系も含めて適切なエラーメッセージが表示されること
- **データ整合性:** CRUD操作後のデータが正しく保存・更新・削除されること

### 2.2 非機能要件

#### 性能要件
| 項目 | 基準値 | 測定方法 |
|------|--------|----------|
| 主要画面応答時間 | 3秒以内 | ブラウザDevTools |
| 検索応答時間 | 2秒以内 | API応答時間測定 |
| 同時接続ユーザー数 | 300名 | 負荷テストツール |
| データベースクエリ応答 | 1秒以内（95パーセンタイル） | PostgreSQL実行計画 |

#### セキュリティ要件
- 認証・認可機構が正常に機能すること
- HTTPS通信が強制されること
- セキュリティヘッダーが適切に設定されていること
- CSRF、XSS、SQLインジェクション対策が有効であること
- パスワードがハッシュ化されて保存されること

#### 可用性要件
- システム稼働率: 99.0%以上（月間）
- バックアップ・リストア機能が動作すること
- エラー発生時の復旧手順が確立されていること

### 2.3 品質要件
- **コードカバレッジ:** 80%以上
- **重大バグ（Critical/High）:** 0件
- **中程度バグ（Medium）:** 5件以内
- **ドキュメント整備:** 全機能のマニュアルが揃っていること

---

## 3. テストシナリオ（エンドツーエンド）

### シナリオ1: ナレッジ登録から配信まで

**目的:** ナレッジが登録され、承認を経て配信されるまでの完全なフローを検証

**前提条件:**
- テストユーザー（作成者、承認者、参照者）が登録済み
- 各ロールに適切な権限が付与されている

**テスト手順:**
1. 作成者としてログイン
2. 新規ナレッジを作成（タイトル、カテゴリ、本文、添付ファイル）
3. カテゴリと重要度を設定
4. 下書き保存後、承認申請を実施
5. 承認者としてログイン
6. 承認待ちナレッジを確認
7. 内容を確認し承認実施
8. 通知が作成者に送信されることを確認
9. 参照者としてログイン
10. 公開されたナレッジを検索・閲覧
11. ナレッジが正しく表示されることを確認

**期待結果:**
- 各ステップが正常に完了すること
- 承認フローが適切に機能すること
- 通知が正しいタイミングで送信されること
- 権限に応じた表示制御が機能すること

---

### シナリオ2: 承認フロー完全実行

**目的:** 承認フローの全パターン（承認、差戻し、却下）を検証

**前提条件:**
- テストナレッジが3件準備されている
- 承認者が2名登録されている

**テスト手順:**

**パターンA: 承認**
1. ナレッジA を承認申請
2. 承認者1が承認
3. ステータスが「公開中」に変更されることを確認

**パターンB: 差戻し**
1. ナレッジB を承認申請
2. 承認者1が差戻し（コメント付き）
3. ステータスが「下書き」に戻ることを確認
4. 作成者に通知が送信されることを確認
5. 作成者が内容を修正し再申請
6. 承認者2が承認
7. ステータスが「公開中」に変更されることを確認

**パターンC: 却下**
1. ナレッジC を承認申請
2. 承認者2が却下（理由記載）
3. ステータスが「却下」に変更されることを確認
4. 作成者に通知が送信されることを確認

**期待結果:**
- 各承認アクションが正しく機能すること
- ステータス遷移が仕様通りであること
- 通知が適切に送信されること
- コメントが正しく記録されること

---

### シナリオ3: 検索から参照まで

**目的:** 全文検索機能とナレッジ参照機能を検証

**前提条件:**
- 公開済みナレッジが50件以上登録されている
- カテゴリが複数設定されている
- タグが複数設定されている

**テスト手順:**
1. ユーザーとしてログイン
2. 検索画面を表示
3. キーワード検索（例: "安全"）を実行
4. 検索結果が2秒以内に表示されることを確認
5. カテゴリフィルターを適用
6. タグフィルターを適用
7. 日付範囲フィルターを適用
8. 検索結果からナレッジを選択
9. ナレッジ詳細画面を表示
10. 関連ナレッジが表示されることを確認
11. 添付ファイルをダウンロード
12. 閲覧履歴に記録されることを確認

**期待結果:**
- 全文検索が正確に動作すること
- 複数フィルターの組み合わせが機能すること
- 応答時間が基準値以内であること
- 閲覧履歴が正しく記録されること

---

### シナリオ4: 事故レポート作成から対応完了まで

**目的:** 事故報告機能の完全なワークフローを検証

**前提条件:**
- 報告者、安全管理者、対応者が登録済み
- 事故カテゴリが設定されている

**テスト手順:**
1. 報告者としてログイン
2. 新規事故レポートを作成
3. 発生日時、場所、内容、重要度を入力
4. 写真を添付（複数）
5. レポートを提出
6. 安全管理者に通知が送信されることを確認
7. 安全管理者としてログイン
8. 新着レポートを確認
9. 対応者をアサイン
10. 対応者に通知が送信されることを確認
11. 対応者としてログイン
12. 対応状況を更新（進行中）
13. コメントを追加
14. 対応完了として状態を更新
15. 報告者と安全管理者に通知が送信されることを確認
16. レポートのステータス履歴が記録されていることを確認

**期待結果:**
- 事故レポートのライフサイクル全体が機能すること
- 適切なタイミングで通知が送信されること
- 履歴が正しく記録されること
- 写真添付が正常に動作すること

---

### シナリオ5: 専門家相談から回答まで

**目的:** Q&A機能の完全なワークフローを検証

**前提条件:**
- 一般ユーザーと専門家ユーザーが登録済み
- カテゴリが設定されている

**テスト手順:**
1. 一般ユーザーとしてログイン
2. 新規質問を作成
3. タイトル、カテゴリ、詳細内容を入力
4. 質問を投稿
5. 専門家に通知が送信されることを確認
6. 専門家としてログイン
7. 新着質問を確認
8. 回答を作成（詳細な説明）
9. 関連ナレッジをリンク
10. 回答を投稿
11. 質問者に通知が送信されることを確認
12. 質問者としてログイン
13. 回答を確認
14. ベストアンサーとして選択
15. 専門家に通知が送信されることを確認
16. Q&Aが検索可能になることを確認

**期待結果:**
- 質問投稿から回答、ベストアンサー選択まで完結すること
- 通知が各段階で送信されること
- 関連ナレッジのリンクが機能すること
- 検索インデックスが更新されること

---

## 4. 性能テスト

### 4.1 負荷テスト

**目的:** 同時接続300名の環境下でシステムが安定稼働することを確認

**テストツール:** Apache JMeter / Locust

**テストシナリオ:**
- 同時ログイン: 300ユーザー
- ナレッジ検索: 100リクエスト/秒
- ナレッジ閲覧: 80リクエスト/秒
- ナレッジ作成: 10リクエスト/秒
- 承認操作: 5リクエスト/秒

**測定項目:**
- 応答時間（平均、95パーセンタイル、99パーセンタイル）
- スループット（リクエスト/秒）
- エラー率
- CPU使用率
- メモリ使用率
- データベース接続数

**合格基準:**
- 平均応答時間が基準値以内
- エラー率が1%未満
- CPU使用率が80%未満
- メモリ使用率が85%未満

### 4.2 ストレステスト

**目的:** システムの限界値と障害時の挙動を確認

**テスト手順:**
1. 負荷を段階的に増加（100→200→300→400→500ユーザー）
2. 各段階で10分間維持
3. システムの応答を監視
4. 限界点を特定
5. 負荷を急激に解放
6. システムの回復を確認

**測定項目:**
- 最大同時接続ユーザー数
- 限界値での応答時間
- エラー発生率の推移
- システム回復時間

**合格基準:**
- 300ユーザーまで安定稼働すること
- 限界超過時に適切なエラーメッセージが表示されること
- 負荷解放後、5分以内に正常稼働に回復すること

### 4.3 応答時間測定

**測定対象:**

| 画面/機能 | 目標値 | 測定方法 |
|-----------|--------|----------|
| ログイン画面 | 2秒以内 | ブラウザDevTools |
| ダッシュボード | 3秒以内 | ブラウザDevTools |
| ナレッジ一覧 | 3秒以内 | ブラウザDevTools |
| ナレッジ詳細 | 3秒以内 | ブラウザDevTools |
| 検索実行 | 2秒以内 | API応答時間 |
| ナレッジ作成 | 3秒以内 | フォーム送信時間 |
| ファイルアップロード（10MB） | 10秒以内 | アップロード完了時間 |
| レポート生成 | 5秒以内 | PDF生成時間 |

**測定条件:**
- ネットワーク: 標準的な企業LAN環境
- クライアント: Chrome最新版、スペック標準PC
- データ量: 本番想定データ（ナレッジ1000件以上）

---

## 5. セキュリティテスト

### 5.1 認証・認可テスト

**テスト項目:**
- [ ] パスワード認証が正常に機能すること
- [ ] JWT トークンが正しく発行・検証されること
- [ ] トークンの有効期限が適切に管理されること
- [ ] ログアウト後はトークンが無効化されること
- [ ] 不正なトークンでAPIアクセスが拒否されること
- [ ] ロールベースアクセス制御（RBAC）が機能すること
- [ ] 権限のない機能へのアクセスが拒否されること

**テスト手順例:**
1. 有効な認証情報でログイン成功を確認
2. 無効な認証情報でログイン失敗を確認
3. トークンなしでAPIアクセスし403エラーを確認
4. 期限切れトークンでアクセスし401エラーを確認
5. 一般ユーザーで管理機能アクセスを試み拒否を確認

### 5.2 HTTPS強制確認

**テスト項目:**
- [ ] HTTPアクセスがHTTPSにリダイレクトされること
- [ ] SSL/TLS証明書が有効であること
- [ ] 暗号化通信が使用されていること（TLS 1.2以上）
- [ ] 安全でない暗号スイートが無効化されていること

**テスト手順:**
1. http://[domain] にアクセス
2. https://[domain] にリダイレクトされることを確認
3. SSL証明書の有効性を確認（ブラウザ警告なし）
4. SSL Labs等でセキュリティスコア確認（A評価以上）

### 5.3 セキュリティヘッダー確認

**確認対象ヘッダー:**
- [ ] `Strict-Transport-Security` (HSTS)
- [ ] `X-Content-Type-Options: nosniff`
- [ ] `X-Frame-Options: DENY` or `SAMEORIGIN`
- [ ] `X-XSS-Protection: 1; mode=block`
- [ ] `Content-Security-Policy`
- [ ] `Referrer-Policy`

**テスト手順:**
1. ブラウザDevToolsでレスポンスヘッダーを確認
2. 各ヘッダーが適切に設定されていることを確認
3. セキュリティヘッダーチェッカーツールで検証

### 5.4 CSRF対策確認

**テスト項目:**
- [ ] CSRFトークンが生成されること
- [ ] フォーム送信時にトークンが検証されること
- [ ] 不正なトークンで送信が拒否されること
- [ ] トークンなしで送信が拒否されること

**テスト手順:**
1. フォーム画面を表示しCSRFトークンの存在を確認
2. トークンを改ざんして送信し403エラーを確認
3. トークンを削除して送信し403エラーを確認
4. 正しいトークンで送信が成功することを確認

### 5.5 XSS対策確認

**テスト項目:**
- [ ] ユーザー入力がエスケープされること
- [ ] スクリプトタグが実行されないこと
- [ ] HTML属性内のXSSが防止されていること
- [ ] JavaScriptイベントハンドラーのXSSが防止されていること

**テストペイロード:**
```html
<script>alert('XSS')</script>
<img src=x onerror="alert('XSS')">
<svg/onload=alert('XSS')>
javascript:alert('XSS')
<iframe src="javascript:alert('XSS')">
```

**テスト手順:**
1. 各入力フィールドにXSSペイロードを入力
2. データを保存し画面に表示
3. スクリプトが実行されず、エスケープされた文字列として表示されることを確認
4. ブラウザコンソールでエラーがないことを確認

### 5.6 SQLインジェクション対策確認

**テスト項目:**
- [ ] パラメータ化クエリが使用されていること
- [ ] SQLインジェクションペイロードが無効化されること
- [ ] エラーメッセージからDB情報が漏洩しないこと

**テストペイロード:**
```sql
' OR '1'='1
'; DROP TABLE users; --
' UNION SELECT * FROM users--
admin'--
```

**テスト手順:**
1. 検索フィールドにSQLペイロードを入力
2. エラーが発生せず、安全に処理されることを確認
3. データベースが影響を受けていないことを確認
4. ログインフォームでSQLインジェクションを試行
5. 認証がバイパスされないことを確認

---

## 6. 互換性テスト

### 6.1 ブラウザ互換性

**対象ブラウザ:**
- [ ] Google Chrome（最新版・1つ前のバージョン）
- [ ] Mozilla Firefox（最新版・1つ前のバージョン）
- [ ] Safari（最新版）
- [ ] Microsoft Edge（最新版）

**テスト項目:**
- 全画面の表示が正常であること
- CSS レイアウトが崩れていないこと
- JavaScript機能が正常に動作すること
- フォーム送信が正常に動作すること
- ファイルアップロードが正常に動作すること

### 6.2 デバイス互換性

**対象デバイス:**
- [ ] デスクトップPC（1920x1080以上）
- [ ] ノートPC（1366x768以上）
- [ ] タブレット（iPad、Android 10インチ）
- [ ] スマートフォン（iPhone、Android 6インチ）

**テスト項目:**
- レスポンシブデザインが機能すること
- タッチ操作が正常に動作すること（モバイル）
- 画面サイズに応じたレイアウト調整がされること
- モバイルでの入力が快適であること

### 6.3 OS互換性

**対象OS:**
- [ ] Windows 10/11
- [ ] macOS（最新版・1つ前のバージョン）
- [ ] Linux（Ubuntu 20.04/22.04）

**テスト項目:**
- ブラウザが正常に動作すること
- ファイル操作が正常に動作すること
- フォントが正しく表示されること

---

## 7. テスト実施スケジュール

### 7.1 スケジュール概要

| フェーズ | 期間 | 担当 | 成果物 |
|----------|------|------|--------|
| テスト準備 | Day 1-2 | QAチーム | テスト環境構築、テストデータ準備 |
| 機能テスト | Day 3-7 | QAチーム全員 | 機能テスト結果報告書 |
| E2Eシナリオテスト | Day 8-10 | シナリオ担当者 | シナリオテスト結果報告書 |
| 性能テスト | Day 11-12 | 性能テスト担当 | 性能テスト結果報告書 |
| セキュリティテスト | Day 13-14 | セキュリティ担当 | セキュリティテスト結果報告書 |
| 互換性テスト | Day 15-16 | 互換性テスト担当 | 互換性テスト結果報告書 |
| 不具合修正 | Day 17-20 | 開発チーム | 修正済みビルド |
| リグレッションテスト | Day 21-23 | QAチーム | リグレッションテスト結果 |
| 最終確認・報告書作成 | Day 24-25 | QAリーダー | 最終受入テスト報告書 |

### 7.2 マイルストーン

- **Day 10:** 主要シナリオテスト完了
- **Day 14:** 非機能テスト完了
- **Day 20:** 全不具合修正完了
- **Day 25:** 最終受入テスト完了、本番リリース判定

---

## 8. テスト完了基準

### 8.1 必須条件（Must）
以下の全てが満たされない限り、本番リリースは不可とする：

- [ ] **重大バグゼロ:** Critical/High優先度のバグが0件
- [ ] **全シナリオ成功:** 5つのE2Eシナリオが全て成功
- [ ] **性能基準達成:** 応答時間、同時接続数が基準値をクリア
- [ ] **セキュリティテスト合格:** 全セキュリティテストが合格
- [ ] **コードカバレッジ80%以上:** 単体テスト・結合テストのカバレッジが基準を満たす
- [ ] **ドキュメント完備:** ユーザーマニュアル、運用マニュアルが完成

### 8.2 推奨条件（Should）
以下は可能な限り達成すべき条件：

- [ ] **中程度バグ:** Medium優先度のバグが5件以内
- [ ] **互換性:** 全対象ブラウザ・デバイスで動作確認完了
- [ ] **ユーザビリティ:** 操作性に関する重大な問題がない
- [ ] **性能余裕:** ピーク時の想定負荷に対して30%以上の余裕がある

### 8.3 判定基準

**合格（本番リリース可）:**
- 全ての必須条件を満たす
- 推奨条件の80%以上を満たす

**条件付き合格（限定リリース可）:**
- 必須条件を満たす
- 推奨条件の50%以上を満たす
- 残課題に対する対応計画が明確

**不合格（リリース延期）:**
- 必須条件のいずれかを満たさない

---

## 9. 不具合管理プロセス

### 9.1 不具合の優先度定義

| 優先度 | 定義 | 対応期限 | 例 |
|--------|------|----------|-----|
| **Critical** | システムが使用不可、データ損失、セキュリティ重大問題 | 即時（24時間以内） | ログイン不可、データ消失、SQL injection可能 |
| **High** | 主要機能が使用不可、業務への重大な影響 | 3営業日以内 | 検索機能停止、承認フロー動作せず |
| **Medium** | 機能の一部に問題、回避策あり | 1週間以内 | 特定条件下でエラー、表示崩れ |
| **Low** | 軽微な問題、使用上の影響小 | 次回リリース時 | 文言誤り、UI微調整 |

### 9.2 不具合報告フロー

1. **発見・記録:** テスターが不具合を発見し、チケット起票
2. **トリアージ:** QAリーダーが優先度を判定
3. **割り当て:** 開発リーダーが担当者を割り当て
4. **修正:** 開発者が修正実施
5. **レビュー:** コードレビュー実施
6. **検証:** QAが修正内容を検証
7. **クローズ:** 問題解決を確認しクローズ

### 9.3 不具合チケット必須項目

- **チケットID:** 一意の識別子
- **発見日時:** 不具合発見日時
- **発見者:** テスター名
- **優先度:** Critical/High/Medium/Low
- **カテゴリ:** 機能名・モジュール名
- **環境:** OS、ブラウザ、バージョン
- **再現手順:** 明確なステップ
- **期待結果:** あるべき動作
- **実際の結果:** 実際に発生した動作
- **スクリーンショット/ログ:** 証跡
- **影響範囲:** どの機能・ユーザーに影響するか

### 9.4 不具合ステータス管理

| ステータス | 説明 |
|-----------|------|
| **New** | 新規報告、未トリアージ |
| **Open** | 確認済み、対応待ち |
| **In Progress** | 修正作業中 |
| **Fixed** | 修正完了、検証待ち |
| **Verified** | 検証完了、問題解決確認 |
| **Closed** | クローズ済み |
| **Reopened** | 再発または修正不十分で再オープン |
| **Deferred** | 次回リリースに延期 |

### 9.5 リグレッション管理

- 不具合修正後は必ずリグレッションテストを実施
- 修正により新たな不具合が発生していないことを確認
- Critical/High不具合の修正は、関連する全テストケースを再実行

---

## 10. テスト環境

### 10.1 ハードウェア構成
- **アプリケーションサーバー:** 本番相当スペック
- **データベースサーバー:** PostgreSQL本番相当スペック
- **クライアント端末:** Windows PC、Mac、タブレット、スマートフォン

### 10.2 ソフトウェア構成
- **OS:** Linux（本番環境と同一）
- **Python:** 3.11以上
- **PostgreSQL:** 15以上
- **ブラウザ:** Chrome、Firefox、Safari、Edge最新版

### 10.3 テストデータ
- **ユーザー:** 各ロール100名ずつ
- **ナレッジ:** 1000件以上（カテゴリ・タグ多様）
- **事故レポート:** 200件
- **Q&A:** 150件
- **添付ファイル:** 各種サイズ・形式

---

## 11. リスクと対策

### 11.1 特定されたリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| テスト環境の不安定性 | 高 | 中 | 環境構築の自動化、バックアップ体制 |
| テストデータ準備の遅延 | 中 | 中 | テストデータ生成スクリプト準備 |
| Critical不具合の発見 | 高 | 低 | 早期テスト開始、開発チームと密連携 |
| スケジュール遅延 | 中 | 中 | バッファ期間確保、優先度管理 |
| 要員不足 | 中 | 低 | 外部リソース確保計画 |

### 11.2 コンティンジェンシープラン

- **Critical不具合発見時:** 即座に開発チームと対策会議、リリース延期判断
- **環境障害時:** 代替環境への切り替え、クラウド環境利用
- **要員不足時:** 優先度の低いテストの延期、外部委託検討

---

## 12. 成果物

### 12.1 テスト報告書
- 機能テスト結果報告書
- E2Eシナリオテスト結果報告書
- 性能テスト結果報告書
- セキュリティテスト結果報告書
- 互換性テスト結果報告書
- 最終受入テスト総合報告書

### 12.2 不具合一覧
- 全不具合リスト（優先度別、ステータス別）
- 未解決不具合リスト
- 既知の制限事項リスト

### 12.3 テスト証跡
- テスト実行ログ
- スクリーンショット
- 性能測定結果データ
- セキュリティスキャン結果

---

## 13. 承認

### 13.1 承認者

| 役割 | 氏名 | 署名 | 日付 |
|------|------|------|------|
| QAリーダー |  |  |  |
| 開発リーダー |  |  |  |
| プロジェクトマネージャー |  |  |  |

### 13.2 変更履歴

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|----------|
| 1.0 | 2025-12-27 | QAチーム | 初版作成 |

---

## 付録A: 参照ドキュメント

- システム要件定義書
- 機能仕様書（フェーズA〜B-9）
- アーキテクチャ設計書
- データベース設計書
- セキュリティ要件定義書
- 運用マニュアル

## 付録B: 用語集

- **E2E (End-to-End):** エンドツーエンド。業務フロー全体を通したテスト
- **RBAC:** ロールベースアクセス制御
- **CSRF:** クロスサイトリクエストフォージェリ
- **XSS:** クロスサイトスクリプティング
- **HSTS:** HTTP Strict Transport Security
- **CSP:** Content Security Policy
