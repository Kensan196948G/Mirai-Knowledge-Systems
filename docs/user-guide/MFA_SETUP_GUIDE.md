# 2要素認証セットアップガイド

## 目次

1. [2要素認証とは？](#2要素認証とは)
2. [必要なもの](#必要なもの)
3. [セットアップ手順](#セットアップ手順)
4. [ログイン方法](#ログイン方法)
5. [バックアップコードの管理](#バックアップコードの管理)
6. [デバイス紛失時の対処法](#デバイス紛失時の対処法)
7. [よくある質問（FAQ）](#よくある質問faq)

---

## 2要素認証とは？

2要素認証（Two-Factor Authentication、2FA）は、パスワードに加えて、もう1つの認証要素（ワンタイムパスワード）を要求することで、アカウントのセキュリティを大幅に向上させる仕組みです。

### メリット

- **セキュリティ強化**: パスワードが漏洩しても、ワンタイムパスワードがなければログインできません
- **不正アクセス防止**: ワンタイムパスワードは30秒ごとに変更されるため、盗聴されても安全です
- **緊急時の対応**: バックアップコードを使用して、認証アプリにアクセスできない場合でもログインできます

---

## 必要なもの

### 1. スマートフォン

以下のいずれかのOSを搭載したスマートフォン:
- iOS 12以降
- Android 6.0以降

### 2. 認証アプリ

以下のいずれかの認証アプリをインストールしてください:

#### Google Authenticator
- [iOS版](https://apps.apple.com/app/google-authenticator/id388497605)
- [Android版](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2)

#### Microsoft Authenticator（推奨）
- [iOS版](https://apps.apple.com/app/microsoft-authenticator/id983156458)
- [Android版](https://play.google.com/store/apps/details?id=com.azure.authenticator)

#### その他の対応アプリ
- Authy
- 1Password
- Bitwarden

---

## セットアップ手順

### ステップ1: MFA設定ページにアクセス

1. Mirai Knowledge Systemsにログインします
2. 右上のメニューから**「設定」**→**「2要素認証」**をクリック
3. **「2要素認証を設定」**ボタンをクリック

![MFA設定ボタン](images/mfa-settings-button.png)

---

### ステップ2: QRコードをスキャン

1. セットアップウィザードが表示されます
2. スマートフォンで認証アプリを開きます
3. 認証アプリで**「アカウントを追加」**または**「+」**ボタンをタップ
4. **「QRコードをスキャン」**を選択
5. 画面に表示されているQRコードをスマートフォンのカメラで読み取ります

![QRコードスキャン](images/mfa-qr-code.png)

#### QRコードが読み取れない場合

「手動入力用シークレットキー」をクリックして展開し、表示されたキーを認証アプリに手動で入力してください。

**手動入力の手順**:
1. 認証アプリで「手動で入力」を選択
2. アカウント名: `Mirai Knowledge Systems`
3. キー: 表示されたシークレットキーをコピー＆ペースト
4. タイプ: **時間ベース**を選択

---

### ステップ3: 認証コードを入力

1. 認証アプリに表示されている**6桁の数字**を確認します
2. セットアップウィザードの「認証コード」欄に入力します
3. **「検証して有効化」**ボタンをクリックします

![認証コード入力](images/mfa-verification.png)

**注意**: コードは30秒ごとに変更されます。時間切れになった場合は、新しいコードを入力してください。

---

### ステップ4: バックアップコードを保存

1. 10個のバックアップコードが表示されます
2. これらのコードを**安全な場所に保存**してください
3. 以下のいずれかの方法で保存します:
   - **ダウンロード**: テキストファイルとしてダウンロード
   - **印刷**: 紙に印刷して保管
   - **パスワードマネージャー**: 1Passwordなどに保存

![バックアップコード](images/mfa-backup-codes.png)

4. 「バックアップコードを安全に保存しました」にチェックを入れます
5. **「完了」**ボタンをクリックします

**重要**: バックアップコードは**一度しか表示されません**。必ず保存してください。

---

## ログイン方法

### 通常のログイン（TOTPコード使用）

1. ユーザー名とパスワードを入力してログインします
2. 2要素認証画面が表示されます
3. スマートフォンで認証アプリを開きます
4. 「Mirai Knowledge Systems」のアカウントに表示されている**6桁のコード**を確認します
5. コードを入力します（6桁入力すると自動的に認証されます）

![MFAログイン](images/mfa-login.png)

**タイムアウト**: 認証画面には5分間の有効期限があります。画面上部に残り時間が表示されます。

---

### バックアップコードを使用したログイン

認証アプリにアクセスできない場合は、バックアップコードを使用できます。

1. ユーザー名とパスワードを入力してログインします
2. 2要素認証画面で**「バックアップコードを使用」**をクリックします
3. 保存しておいたバックアップコードのいずれかを入力します
4. ログインボタンをクリックします

**注意**:
- バックアップコードは**1回のみ使用可能**です
- 使用したコードは無効になります
- 残りのコードが3個以下になると警告が表示されます

---

## バックアップコードの管理

### 残りのコード数を確認

1. ログイン後、**「設定」**→**「2要素認証」**にアクセス
2. 「残りのバックアップコード」欄で確認できます

![バックアップコード残数](images/mfa-backup-remaining.png)

---

### 新しいバックアップコードを生成

バックアップコードを使い切った、または紛失した場合は、新しいコードを生成できます。

1. **「設定」**→**「2要素認証」**にアクセス
2. **「バックアップコード再生成」**ボタンをクリック
3. 認証アプリの6桁コードを入力
4. 新しい10個のバックアップコードが表示されます
5. **必ず保存してください**（古いコードは無効になります）

**重要**: 新しいコードを生成すると、**古いバックアップコードはすべて無効**になります。

---

## デバイス紛失時の対処法

### ケース1: スマートフォンを紛失した（バックアップコードあり）

1. バックアップコードを使用してログインします
2. ログイン後、すぐに以下の手順を実行してください:
   - 新しいデバイスに認証アプリをインストール
   - **「設定」**→**「2要素認証」**→**「2要素認証を無効化」**
   - 再度**「2要素認証を設定」**で新しいデバイスをセットアップ

---

### ケース2: スマートフォンもバックアップコードも紛失した

**管理者に連絡してください**。

連絡先:
- Email: admin@yourcompany.com
- 内線: XXX-XXXX

管理者による本人確認後、2要素認証をリセットできます。

**必要な情報**:
- ユーザー名
- 登録メールアドレス
- 社員番号

---

## よくある質問（FAQ）

### Q1: 認証コードが「無効なコード」と表示される

**A**: 以下を確認してください:

1. **時刻同期の確認**:
   - スマートフォンの時刻設定が自動になっているか確認
   - 設定 → 一般 → 日付と時刻 → 自動設定をON

2. **コードの有効期限**:
   - コードは30秒ごとに変更されます
   - 新しいコードが表示されるまで待ってから入力

3. **正しいアカウント**:
   - 認証アプリで「Mirai Knowledge Systems」のコードを使用しているか確認

---

### Q2: QRコードをスキャンできない

**A**: 以下を試してください:

1. **明るさ調整**: 画面の明るさを最大にする
2. **距離調整**: スマートフォンを画面に近づけたり遠ざけたりする
3. **手動入力**: QRコードの下の「手動入力用シークレットキー」を使用

---

### Q3: スマートフォンを機種変更する場合

**A**: 以下の手順で引き継ぎできます:

#### 方法1: アプリのバックアップ機能を使用（推奨）

- Microsoft Authenticator: クラウドバックアップ機能あり
- Authy: 複数デバイス同期機能あり

#### 方法2: 手動で再セットアップ

1. **古いデバイスで**:
   - まだ使える場合、そのままにしておく

2. **新しいデバイスで**:
   - 認証アプリをインストール
   - Mirai Knowledge Systemsにログイン
   - 「設定」→「2要素認証」→「無効化」
   - 再度「設定」→「2要素認証」→「設定」で新しいQRコードをスキャン

---

### Q4: 複数のデバイスで同じアカウントを使用できますか？

**A**: はい、可能です。

同じQRコードを複数の認証アプリでスキャンすれば、複数のデバイスで同じワンタイムパスワードが生成されます。

**推奨設定**:
- メインデバイス: スマートフォン
- バックアップデバイス: タブレットまたは別のスマートフォン

---

### Q5: 2要素認証を無効化したい

**A**: 以下の手順で無効化できます:

1. **「設定」**→**「2要素認証」**にアクセス
2. **「2要素認証を無効化」**ボタンをクリック
3. 以下の情報を入力:
   - 現在のパスワード
   - 認証アプリの6桁コード（またはバックアップコード）
4. **「無効化」**ボタンをクリック

**セキュリティ上の注意**: 2要素認証を無効化すると、アカウントのセキュリティが低下します。特別な理由がない限り、有効のままにすることを強く推奨します。

---

### Q6: バックアップコードの有効期限はありますか？

**A**: いいえ、有効期限はありません。

ただし、以下の場合は無効になります:
- 一度使用した後（使用したコードのみ）
- 新しいバックアップコードを再生成した場合（すべての古いコード）

---

### Q7: 認証アプリを削除してしまった

**A**: バックアップコードがあれば問題ありません。

1. バックアップコードでログイン
2. 認証アプリを再インストール
3. 2要素認証を無効化
4. 再度セットアップ

バックアップコードもない場合は、管理者に連絡してください。

---

### Q8: 30秒で6桁を入力するのが間に合わない

**A**: 心配いりません。

- コードは30秒ごとに変更されますが、前後のコードも有効です（±30秒の猶予）
- コードをメモしてから入力しても大丈夫です
- 6桁入力すると自動的に認証されます

---

### Q9: 仕事用と個人用のスマートフォン、どちらを使うべきですか？

**A**: どちらでも使用できますが、以下を推奨します:

**仕事用スマートフォン（推奨）**:
- メリット: 常に携帯している、会社の管理下
- デメリット: 故障・紛失時に業務に影響

**個人用スマートフォン**:
- メリット: 常に携帯している、個人で管理
- デメリット: 退職時に削除が必要

**ベストプラクティス**: 両方にセットアップして、どちらでもログインできるようにする。

---

## サポート

### 技術サポート

2要素認証に関する問題が発生した場合は、以下にお問い合わせください。

- **Email**: support@yourcompany.com
- **内線**: XXX-XXXX
- **営業時間**: 平日 9:00-18:00

### 緊急時（ログインできない）

- **緊急連絡先**: XXX-XXXX-XXXX（24時間対応）

---

## チェックリスト

セットアップ完了後、以下を確認してください:

- [ ] 認証アプリに「Mirai Knowledge Systems」が追加されている
- [ ] バックアップコードを安全な場所に保存した
- [ ] ログインテストに成功した
- [ ] スマートフォンの時刻設定が自動になっている
- [ ] バックアップデバイスも設定した（推奨）

---

**最終更新**: 2026-01-31
**バージョン**: 1.0
