# 本番環境運用開始チェックリスト (Production Go-Live Checklist)

## 目次
1. [事前準備](#1-事前準備)
2. [インフラストラクチャ](#2-インフラストラクチャ)
3. [セキュリティ](#3-セキュリティ)
4. [データベース](#4-データベース)
5. [アプリケーション](#5-アプリケーション)
6. [監視・アラート](#6-監視・アラート)
7. [バックアップ・リカバリ](#7-バックアップ・リカバリ)
8. [ドキュメント・トレーニング](#8-ドキュメント・トレーニング)
9. [運用体制](#9-運用体制)
10. [Go-Live当日](#10-go-live当日)

---

## 1. 事前準備

### 1.1 プロジェクト管理

| # | チェック項目 | 担当者 | 確認日 | 状態 |
|---|-------------|--------|--------|------|
| 1.1.1 | 全Phase (B-1〜B-11) の完了確認 | PM | 2026-01-07 | ✅ |
| 1.1.2 | 本番移行計画書の承認 | PM | | ☐ |
| 1.1.3 | ロールバック手順の確認 | Tech Lead | | ☐ |
| 1.1.4 | 関係者への周知 | PM | | ☐ |
| 1.1.5 | 切り戻し判断基準の合意 | PM | | ☐ |

### 1.2 リソース確認

| # | チェック項目 | 担当者 | 確認日 | 状態 |
|---|-------------|--------|--------|------|
| 1.2.1 | 本番サーバーの準備完了 | Infra | 2026-01-07 | ✅ |
| 1.2.2 | ネットワーク構成の確認 | Network | | ☐ |
| 1.2.3 | 運用担当者のアサイン | PM | | ☐ |
| 1.2.4 | 緊急連絡先リストの作成 | PM | | ☐ |

---

## 2. インフラストラクチャ

### 2.1 サーバー

| # | チェック項目 | コマンド/確認方法 | 状態 |
|---|-------------|------------------|------|
| 2.1.1 | CPU/メモリ十分か | `htop` / `free -h` | ✅ |
| 2.1.2 | ディスク空き容量 | `df -h` (20GB以上推奨) | ✅ |
| 2.1.3 | OS セキュリティパッチ | `sudo apt update && apt list --upgradable` | ☐ |
| 2.1.4 | タイムゾーン設定 | `timedatectl` (Asia/Tokyo) | ✅ |
| 2.1.5 | NTP同期 | `timedatectl status` | ✅ |

### 2.2 Webサーバー (Nginx)

| # | チェック項目 | コマンド/確認方法 | 状態 |
|---|-------------|------------------|------|
| 2.2.1 | Nginx稼働中 | `systemctl status nginx` | ✅ |
| 2.2.2 | SSL証明書設定 | `curl -v https://172.23.10.109` | ✅ |
| 2.2.3 | HTTPSリダイレクト | `curl -I http://172.23.10.109` | ✅ |
| 2.2.4 | Gzip圧縮有効 | レスポンスヘッダー確認 | ✅ |
| 2.2.5 | アクセスログ設定 | `/var/log/nginx/access.log` | ✅ |

### 2.3 アプリケーションサーバー (Gunicorn)

| # | チェック項目 | コマンド/確認方法 | 状態 |
|---|-------------|------------------|------|
| 2.3.1 | systemdサービス有効 | `systemctl is-enabled mirai-knowledge-production` | ✅ |
| 2.3.2 | ワーカー数設定 | `gunicorn.conf.py` (CPUコア数×2+1) | ✅ |
| 2.3.3 | ヘルスチェック応答 | `curl https://172.23.10.109/api/v1/health` | ✅ |

---

## 3. セキュリティ

### 3.1 認証・認可

| # | チェック項目 | 確認方法 | 状態 |
|---|-------------|---------|------|
| 3.1.1 | JWT秘密鍵の設定 | `.env`ファイル確認 | ✅ |
| 3.1.2 | セッションタイムアウト | 30分で自動ログアウト | ✅ |
| 3.1.3 | パスワードポリシー | 12文字以上、複雑性要件 | ✅ |
| 3.1.4 | アカウントロックアウト | 5回失敗で30分ロック | ✅ |
| 3.1.5 | デモアカウント無効化 | 本番環境で確認 | ☐ |

### 3.2 通信セキュリティ

| # | チェック項目 | 確認方法 | 状態 |
|---|-------------|---------|------|
| 3.2.1 | HTTPS強制 | HTTPリダイレクト確認 | ✅ |
| 3.2.2 | TLSバージョン | TLS 1.2以上のみ | ✅ |
| 3.2.3 | セキュリティヘッダー | X-Frame-Options, CSP等 | ✅ |
| 3.2.4 | CORS設定 | 許可オリジンの確認 | ✅ |

### 3.3 データ保護

| # | チェック項目 | 確認方法 | 状態 |
|---|-------------|---------|------|
| 3.3.1 | パスワードハッシュ | bcrypt使用確認 | ✅ |
| 3.3.2 | センシティブデータ暗号化 | DB列暗号化確認 | ☐ |
| 3.3.3 | 監査ログ有効 | アクセスログ記録確認 | ✅ |
| 3.3.4 | ファイルアップロード制限 | サイズ・形式制限 | ✅ |

---

## 4. データベース

### 4.1 PostgreSQL設定

| # | チェック項目 | コマンド/確認方法 | 状態 |
|---|-------------|------------------|------|
| 4.1.1 | PostgreSQL稼働中 | `systemctl status postgresql` | ✅ |
| 4.1.2 | 接続制限設定 | `pg_hba.conf` | ✅ |
| 4.1.3 | 最大接続数 | `max_connections` (100推奨) | ✅ |
| 4.1.4 | 共有バッファ | `shared_buffers` (RAM 25%) | ✅ |

### 4.2 データ

| # | チェック項目 | 確認方法 | 状態 |
|---|-------------|---------|------|
| 4.2.1 | 本番データ投入 | 件数確認 | ✅ (51件) |
| 4.2.2 | インデックス作成 | EXPLAIN ANALYZE | ✅ |
| 4.2.3 | マスタデータ設定 | カテゴリ、ロール等 | ✅ |
| 4.2.4 | 初期管理者アカウント | system_admin | ✅ |

---

## 5. アプリケーション

### 5.1 機能確認

| # | チェック項目 | テスト方法 | 状態 |
|---|-------------|-----------|------|
| 5.1.1 | ログイン/ログアウト | 各ロールでテスト | ✅ |
| 5.1.2 | ナレッジ検索 | キーワード検索実行 | ✅ |
| 5.1.3 | ナレッジ作成 | 新規登録テスト | ✅ |
| 5.1.4 | 承認フロー | 承認/却下テスト | ✅ |
| 5.1.5 | 通知機能 | 通知配信確認 | ✅ |
| 5.1.6 | ダッシュボード | 統計表示確認 | ✅ |

### 5.2 パフォーマンス

| # | チェック項目 | 基準 | 状態 |
|---|-------------|------|------|
| 5.2.1 | APIレスポンス | P95 < 500ms | ✅ |
| 5.2.2 | ページロード | < 3秒 | ✅ |
| 5.2.3 | 検索レスポンス | < 1秒 | ✅ |
| 5.2.4 | 同時接続数 | 100ユーザー | ✅ |

---

## 6. 監視・アラート

### 6.1 監視システム

| # | チェック項目 | URL/コマンド | 状態 |
|---|-------------|-------------|------|
| 6.1.1 | Prometheus稼働 | http://localhost:9090 | ✅ |
| 6.1.2 | Grafana稼働 | http://localhost:3000 | ✅ |
| 6.1.3 | メトリクス収集 | /metrics エンドポイント | ✅ |
| 6.1.4 | ダッシュボード設定 | Grafana Dashboard | ✅ |

### 6.2 アラート設定

| # | チェック項目 | 閾値 | 状態 |
|---|-------------|------|------|
| 6.2.1 | CPU使用率アラート | > 80% (warning), > 95% (critical) | ✅ |
| 6.2.2 | メモリ使用率アラート | > 85% (warning), > 95% (critical) | ✅ |
| 6.2.3 | ディスク使用率アラート | > 90% | ✅ |
| 6.2.4 | エラー率アラート | > 5% | ✅ |
| 6.2.5 | サービスダウンアラート | 1分間応答なし | ✅ |
| 6.2.6 | 通知先設定 | メール/Slack | ☐ |

---

## 7. バックアップ・リカバリ

### 7.1 バックアップ設定

| # | チェック項目 | 確認方法 | 状態 |
|---|-------------|---------|------|
| 7.1.1 | 日次バックアップcron | `/etc/cron.d/mirai-knowledge-backup` | ✅ |
| 7.1.2 | バックアップ保存先 | `/mnt/backup/` | ✅ |
| 7.1.3 | バックアップ世代管理 | 7日間保持 | ✅ |
| 7.1.4 | バックアップ完了通知 | ログ確認 | ☐ |

### 7.2 リカバリテスト

| # | チェック項目 | 実施日 | 状態 |
|---|-------------|--------|------|
| 7.2.1 | バックアップからのリストアテスト | | ☐ |
| 7.2.2 | Point-in-Time Recovery テスト | | ☐ |
| 7.2.3 | リカバリ手順書の検証 | | ☐ |
| 7.2.4 | RTO/RPO達成確認 | | ☐ |

---

## 8. ドキュメント・トレーニング

### 8.1 ドキュメント

| # | ドキュメント名 | パス | 状態 |
|---|--------------|------|------|
| 8.1.1 | エンドユーザーガイド | `docs/11_運用保守/05_End-User-Guide.md` | ✅ |
| 8.1.2 | 管理者ガイド | `docs/11_運用保守/04_Administrator-Guide.md` | ✅ |
| 8.1.3 | 運用手順書 | `docs/11_運用保守/01_運用手順.md` | ✅ |
| 8.1.4 | インシデント対応手順 | `docs/11_運用保守/06_Incident-Response-Procedures.md` | ✅ |
| 8.1.5 | パスワード管理ガイド | `docs/11_運用保守/09_Password-Management-Guide.md` | ✅ |
| 8.1.6 | 監視セットアップガイド | `docs/11_運用保守/07_Monitoring-Setup-Guide.md` | ✅ |
| 8.1.7 | バックアップ・リストア手順 | `docs/11_運用保守/08_Backup-Restore-Procedures.md` | ✅ |

### 8.2 トレーニング

| # | チェック項目 | 対象者 | 状態 |
|---|-------------|--------|------|
| 8.2.1 | エンドユーザートレーニング | 全ユーザー | ☐ |
| 8.2.2 | 管理者トレーニング | system_admin | ☐ |
| 8.2.3 | 運用担当者トレーニング | 運用チーム | ☐ |
| 8.2.4 | FAQ/ヘルプデスク準備 | サポート | ☐ |

---

## 9. 運用体制

### 9.1 担当者

| 役割 | 担当者 | 連絡先 | バックアップ |
|------|--------|--------|-------------|
| システム管理者 | | | |
| アプリケーション担当 | | | |
| データベース担当 | | | |
| ネットワーク担当 | | | |
| セキュリティ担当 | | | |

### 9.2 エスカレーション

| レベル | 対応時間 | 対応者 | 連絡方法 |
|--------|---------|--------|----------|
| L1 (軽微) | 営業時間内 | ヘルプデスク | メール |
| L2 (中程度) | 4時間以内 | 運用チーム | 電話 |
| L3 (重大) | 1時間以内 | Tech Lead | 緊急連絡 |
| L4 (クリティカル) | 即時 | 全担当者 | 全手段 |

---

## 10. Go-Live当日

### 10.1 実施前確認 (T-1時間)

| # | チェック項目 | 実施者 | 確認時刻 | 状態 |
|---|-------------|--------|---------|------|
| 10.1.1 | 全サービス稼働確認 | | | ☐ |
| 10.1.2 | 監視ダッシュボード確認 | | | ☐ |
| 10.1.3 | バックアップ完了確認 | | | ☐ |
| 10.1.4 | 運用チーム待機確認 | | | ☐ |
| 10.1.5 | ロールバック手順確認 | | | ☐ |

### 10.2 Go-Live実施

| # | アクション | 実施者 | 実施時刻 | 状態 |
|---|-----------|--------|---------|------|
| 10.2.1 | 最終ヘルスチェック | | | ☐ |
| 10.2.2 | ユーザーアクセス開放 | | | ☐ |
| 10.2.3 | アナウンス送信 | | | ☐ |
| 10.2.4 | 初期アクセス監視 | | | ☐ |

### 10.3 実施後確認 (T+1時間)

| # | チェック項目 | 実施者 | 確認時刻 | 状態 |
|---|-------------|--------|---------|------|
| 10.3.1 | エラー発生有無 | | | ☐ |
| 10.3.2 | パフォーマンス異常有無 | | | ☐ |
| 10.3.3 | ユーザーフィードバック収集 | | | ☐ |
| 10.3.4 | 問題報告チケット確認 | | | ☐ |

### 10.4 ロールバック判断基準

以下の条件に該当する場合、ロールバックを検討：

1. **即時ロールバック**
   - 全ユーザーがログイン不可
   - データ破損の疑い
   - セキュリティインシデント発生

2. **1時間以内に判断**
   - エラー率が10%を超過
   - 主要機能が利用不可
   - パフォーマンスが著しく低下

3. **状況監視継続**
   - 軽微なエラーが散発
   - 一部機能の遅延

---

## 承認履歴

| 役職 | 氏名 | 承認日 | サイン |
|------|------|--------|--------|
| プロジェクトマネージャー | | | |
| テクニカルリード | | | |
| 品質保証担当 | | | |
| セキュリティ担当 | | | |

---

## 更新履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| 2026-01-07 | 1.0.0 | 初版作成 | Claude Code |

---

**このチェックリストは本番稼働前に全項目の確認が必要です。**
