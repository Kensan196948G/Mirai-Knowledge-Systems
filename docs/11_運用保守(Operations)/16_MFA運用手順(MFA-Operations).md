# 16_MFA運用手順(MFA-Operations)

## 概要
多要素認証(MFA)の運用手順を記載します。MFAはアカウントセキュリティを強化するための重要な機能です。

## MFA設定手順

### 管理者向け設定
1. **MFA有効化の確認**
   - システム設定でMFAが有効になっていることを確認
   - デフォルト設定：新規ユーザーに対してMFAを必須とする

2. **MFAプロバイダーの設定**
   - TOTP (Time-based One-Time Password) を使用
   - サポートアプリ：Google Authenticator, Microsoft Authenticator, Authy

3. **バックアップコードの生成**
   - 各ユーザーに対して10個のバックアップコードを生成
   - 安全な場所に保管

### ユーザー向け設定
1. **初回ログイン時のMFA設定**
   - ログイン後、QRコードが表示される
   - 認証アプリでQRコードをスキャン
   - 6桁のコードを入力して設定完了

2. **MFA設定の変更**
   - プロフィール設定からMFAを再設定可能
   - 既存の設定は無効化される

## ユーザー管理

### MFAステータスの確認
```bash
# データベースからMFAステータスを確認
SELECT username, mfa_enabled, mfa_last_used FROM users WHERE mfa_enabled = true;
```

### MFAの強制リセット
- セキュリティインシデント発生時
- ユーザーのリクエスト時
- 定期的なセキュリティポリシー適用時

### バックアップコードの管理
- バックアップコードの使用履歴をログに記録
- コードの再生成は管理者のみ可能

## 監視とアラート

### 監視項目
- MFA設定率：全ユーザーのうちMFA有効ユーザーの割合
- MFA失敗率：ログイン試行に対するMFA失敗の割合
- 異常アクセス：短時間に複数回のMFA失敗

### アラート設定
- MFA設定率が80%未満の場合：警告
- MFA失敗率が10%を超える場合：警告
- 同一IPからの連続MFA失敗：警告

## 定期メンテナンス

### 毎週
- MFA設定率の確認
- 失敗ログのレビュー

### 毎月
- MFA関連ログの分析
- バックアップコードの有効性確認

### 毎四半期
- MFAポリシーの見直し
- セキュリティトレーニングの実施

## ログ管理

### MFA関連ログ
- MFA設定イベント
- MFA認証成功/失敗
- バックアップコード使用
- MFAリセットイベント

### ログ保持期間
- MFAログ：1年
- セキュリティイベント：3年

## コンプライアンス

### GDPR対応
- MFA設定はユーザーの同意に基づく
- データ削除時のMFA情報も削除

### セキュリティ基準
- NIST SP 800-63B 準拠
- ISO 27001 セキュリティ基準対応