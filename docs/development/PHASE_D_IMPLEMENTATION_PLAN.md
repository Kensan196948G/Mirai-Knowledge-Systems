# Phase D: WebUI完全実装計画書

**作成日**: 2026-01-12
**作成者**: 🧭 Spec Planner（AI SubAgent）
**承認者**: （未承認）
**対象プロジェクト**: Mirai Knowledge Systems

---

## 📊 エグゼクティブサマリー

### 現状評価

| 項目 | 完成度 | 状態 |
|------|--------|------|
| **UI/デザイン** | 80-85% | 🟢 基本レイアウト・コンポーネント完成 |
| **ロジック/機能** | 50-60% | 🟡 APIスタブ実装、動的データ未完成 |
| **バックエンドAPI** | 95% | 🟢 27エンドポイント、テストカバレッジ91% |
| **インフラ** | 100% | 🟢 本番環境稼働中（systemd + Nginx + PostgreSQL） |

### 技術的負債スキャン結果

- **WebUIファイル合計**: 13,619行（HTML + JavaScript）
- **バックエンドコア**: 3,722行（app_v2.py）
- **ダミーデータ使用箇所**: 35箇所（app.js: 32箇所、detail-pages.js: 3箇所）
- **未実装APIスタブ**: 8箇所（承認フローUI、配信申請、編集機能など）

---

## 🎯 実装ギャップ分析

### 🔴 Critical（必須・本番稼働ブロッカー）- 5項目

#### 1. 承認者専用UI（Approval Management UI）

**現状**:
- UI存在: index.html L219-240（承認フロー/ナレッジ配信パネル）
- ボタン実装: `approveSelected()`, `rejectSelected()` - app.js L1452-1523
- バックエンドAPI: ✅ 完備（/api/v1/approvals、approve、reject）

**問題点**:
- 承認一覧の詳細UIがない（現在は静的サンプル3件のみ）
- 承認待ち件数表示のみで、個別選択・一括処理UIなし
- 承認履歴・差戻しメモ機能が未実装

**必要な実装**:
- 承認一覧モーダル/専用ページ（承認箱詳細画面）
- 個別選択チェックボックス、一括承認UI
- 差戻しメモ入力フォーム
- 承認履歴タイムライン表示

**工数見積もり**: 2.5人日

---

#### 2. 検索結果の編集機能（Knowledge Edit Functionality）

**現状**:
- 編集モーダル: ✅ 存在（search-detail.html L295-336）
- 編集フォームフィールド: ✅ 完備
- 編集関数: app.js L1529 `editKnowledge()` - **実装未完成**
- バックエンドAPI: ✅ 完備（PUT /api/v1/knowledge/<id>）

**問題点**:
- 編集フォームへのデータロード処理なし
- 保存処理（saveKnowledgeEdit）が未実装
- 編集権限チェックが不完全

**必要な実装**:
- 既存データのフォームへの自動ロード
- 編集保存処理（PUT APIコール）
- 楽観的ロック/競合検出
- 編集履歴の記録・表示

**工数見積もり**: 2人日

---

#### 3. 現場通知フィードのクリック詳細（Notification Detail View）

**現状**:
- 通知フィード表示: ✅ index.html L431-445（静的3件）
- 通知クリック処理: notifications.js L92 `handleNotificationClick(n.id)` - **実装不明**
- バックエンドAPI: ✅ 完備

**問題点**:
- 通知クリック時の詳細表示がない
- 通知タイプ別のアクション分岐なし

**必要な実装**:
- 通知タイプ別のルーティング処理
- 通知詳細モーダル
- 通知アクション実行

**工数見積もり**: 1.5人日

---

#### 4. 現場共有申請の詳細フォーム（Share Request Form）

**現状**:
- 共有ボタン: ✅ index.html L463
- 処理関数: actions.js L69 `submitDistribution()` - **スタブ実装**
- バックエンドAPI: ❌ 未実装

**問題点**:
- 現在はトースト表示のみ
- 配信先選択UI、承認フローUIなし

**必要な実装**:
- 配信申請フォームモーダル
- バックエンドAPIエンドポイント作成
- 承認フローとの統合

**工数見積もり**: 3人日

---

#### 5. バックエンドAPI連携の全面整備（Full API Integration）

**現状**:
- APIクライアント: ✅ app.js L217-263 `fetchAPI()` 実装済み
- エンドポイント利用: 10箇所でfetch()呼び出し確認

**問題点**:
- 多くの画面で静的ダミーデータを表示
- 動的データ取得・表示ロジックが不完全

**必要な実装**:
- ダミーデータの段階的置換（35箇所）
- ローディング状態の統一実装
- エラー表示の統一

**工数見積もり**: 4人日

---

### 🟡 Medium（優先度中）- 4項目

#### 6. 動的データ表示ロジック強化
**工数**: 2人日

#### 7. ブックマーク/いいね/共有ボタン追加
**工数**: 2.5人日（API実装含む）

#### 8. 管理画面の統合・再設計
**工数**: 3人日

#### 9. プロジェクト進捗のサンプルデータ
**工数**: 1人日

---

### 🟢 Low（優先度低）- 3項目

#### 10. 最近追加の件数調整
**工数**: 0.5人日

#### 11. プロジェクト件数調整
**工数**: 0.5人日

#### 12. マップスナップ実装
**工数**: 2人日

---

## 📅 実装ロードマップ

### Phase D-1: Critical修正（本番稼働ブロッカー解消）
**期間**: 5-7営業日
**工数**: 13人日

**実装順序**:
1. バックエンドAPI連携整備（#5）- 4人日
2. 承認者専用UI（#1）- 2.5人日
3. 検索結果編集機能（#2）- 2人日
4. 通知クリック詳細（#3）- 1.5人日
5. 共有申請フォーム（#4）- 3人日

**成果物**: 本番稼働可能状態

---

### Phase D-2: Medium機能追加（完成度向上）
**期間**: 4-5営業日
**工数**: 8.5人日

**成果物**: 機能要件100%達成

---

### Phase D-3: Low品質改善（オプション）
**期間**: 2営業日
**工数**: 3人日

**成果物**: 長期運用最適化完了

---

## 📊 工数総合計

| Phase | 工数 | 期間目安 | 優先度 |
|-------|------|---------|--------|
| **Phase D-1 (Critical)** | 13人日 | 5-7営業日 | ★★★ |
| **Phase D-2 (Medium)** | 8.5人日 | 4-5営業日 | ★★ |
| **Phase D-3 (Low)** | 3人日 | 2営業日 | ★ |
| **合計** | **24.5人日** | **11-14営業日** | - |

**推奨リソース配分**:
- 1名フルタイム: 約5週間（Phase D-1のみなら2週間）
- 2名並列: 約3週間（Phase D-1のみなら1週間）
- 3名並列: 約2週間（Phase D-1のみなら1週間）

---

## 🚨 リスク評価・軽減策

| リスク | 影響度 | 確率 | 軽減策 |
|--------|--------|------|--------|
| API互換性問題 | 高 | 中 | 事前に全エンドポイントのE2Eテスト実行 |
| ダミーデータ依存の見落とし | 中 | 高 | Grep全スキャン→チェックリスト作成 |
| 承認フロー複雑化 | 中 | 中 | 段階的実装（基本→差戻しメモ→履歴） |
| MS365連携遅延 | 低 | 高 | Phase D-1では配信申請のみ実装 |
| フロントエンド肥大化 | 中 | 中 | app.jsをモジュール分割 |

---

## 📝 本番稼働までのチェックリスト

### Phase D-1完了判定基準

- [ ] ダミーデータ35箇所すべて削除・API化
- [ ] 承認箱詳細画面が動作（承認/却下/差戻し）
- [ ] 検索結果編集が完全動作（ロード→保存）
- [ ] 通知クリック時の適切な画面遷移
- [ ] 配信申請フォーム動作（バックエンドAPI含む）
- [ ] すべての画面でローディング・エラー表示
- [ ] E2Eテスト追加（新機能5項目）
- [ ] ブラウザ互換性確認
- [ ] レスポンシブデザイン確認
- [ ] セキュリティ監査

---

## 📁 Critical Files

### 最重要ファイル（Phase D-1）

1. `/webui/app.js` (2,874行) - フロントエンドコアロジック
2. `/backend/app_v2.py` (3,722行) - バックエンドAPI
3. `/webui/actions.js` (354行) - 承認・配信申請処理
4. `/webui/notifications.js` (150行推定) - 通知処理
5. `/webui/index.html` (650行推定) - ダッシュボードUI

---

**作成日**: 2026-01-12
**次回レビュー**: Phase D-1開始前
