# Phase B-10 本番開発フェーズ - 現状評価と計画

## 更新日: 2026-01-07

---

## 1. 現状評価

### 1.1 システム状態サマリー

| 項目 | 状態 | 備考 |
|------|------|------|
| バックエンドAPI | 稼働中 | Flask 3.1.2, v2.0.0 |
| データベース | PostgreSQL 16.11 | JSON→PostgreSQL移行完了 |
| フロントエンド | 稼働中 | Vanilla JS (ES6+) |
| systemdサービス | 有効 | 自動起動設定済み |
| テストカバレッジ | 91.07% | 538テスト全PASS |
| セキュリティ | 強化済み | XSS修正、セキュアロガー |

### 1.2 データベース移行状態

```
スキーマ構成: 3スキーマ / 16テーブル
├── auth (認証・認可)
│   ├── users          : 3件
│   ├── roles          : 4件 (admin, editor, viewer, expert)
│   ├── permissions    : 7件
│   ├── user_roles     : N/A
│   └── role_permissions: N/A
├── public (ナレッジドメイン)
│   ├── knowledge      : 51件 (ダミーデータ含む)
│   ├── sop            : 30件 (ダミーデータ含む)
│   ├── regulations    : 3件 (ダミーデータ含む)
│   ├── incidents      : 20件 (ダミーデータ含む)
│   ├── consultations  : 15件 (ダミーデータ含む)
│   ├── approvals      : N/A
│   ├── notifications  : N/A
│   └── notification_reads: N/A
└── audit (監査ログ)
    ├── access_logs    : 692件
    ├── change_logs    : N/A
    └── distribution_logs: N/A
```

### 1.3 完了済みフェーズ

| Phase | 名称 | 完了日 | 主な成果 |
|-------|------|--------|----------|
| B-1〜B-5 | 基盤実装 | 2025-12 | アーキテクチャ、DB設計、API設計 |
| B-6 | 検索・通知 | 2025-12 | 全文検索、通知配信機能 |
| B-7 | WebUI統合 | 2025-12 | ログイン、ダッシュボード、管理画面 |
| B-8 | セキュリティ | 2026-01-06 | XSS修正、CSRF対策、セキュアロガー |
| B-9 | 品質保証 | 2026-01-07 | カバレッジ91%、E2E、セキュリティスキャン |
| B-10 | PostgreSQL移行 | 2026-01-07 | JSON→PostgreSQL完了 |

---

## 2. 本番開発フェーズ定義

### Phase B-11: 本番準備 (Production Readiness)

#### 2.1 ダミーデータ対応
- [ ] 既存ダミーデータの特定とフラグ付け
- [ ] ダミーデータ削除機能実装
- [ ] 空データ時の「○○データなし」表示実装
- [ ] UI/UXテスト（空状態の表示確認）

#### 2.2 HTTPS/SSL証明書設定
- [ ] 自己署名SSL証明書生成
- [ ] Nginx HTTPS設定
- [ ] HTTP→HTTPSリダイレクト
- [ ] セキュリティヘッダー確認

#### 2.3 本番環境変数設定
- [ ] MKS_ENV=production 設定
- [ ] SECRET_KEY本番用値設定
- [ ] DATABASE_URL本番接続設定
- [ ] ログレベル調整

### Phase B-12: データ移行準備 (Data Migration)

#### 3.1 既存サーバーからのデータ移行
- [ ] データソース特定と接続確認
- [ ] データフォーマット分析
- [ ] 移行スクリプト作成
- [ ] テスト移行実行

#### 3.2 Microsoft 365連携
- [ ] SharePoint/OneDrive接続設定
- [ ] ファイル一覧取得機能
- [ ] メタデータ抽出機能
- [ ] 増分同期機能

#### 3.3 データ品質管理
- [ ] 重複チェック
- [ ] データバリデーション
- [ ] 変換エラーログ
- [ ] レポート生成

### Phase B-13: ドキュメント整備 (Documentation)

#### 4.1 DB構造設計書
- [ ] 論理データモデル（ER図）
- [ ] 物理データモデル（テーブル定義書）
- [ ] インデックス設計書
- [ ] データ辞書

#### 4.2 運用ドキュメント
- [ ] デプロイ手順書
- [ ] 障害対応手順書
- [ ] バックアップ・リストア手順
- [ ] 監視設定ガイド

#### 4.3 Claude Code用プロンプト
- [ ] 開発作業用プロンプトテンプレート
- [ ] 保守作業用プロンプトテンプレート
- [ ] トラブルシューティング用プロンプト

### Phase B-14: 統合テスト (Integration Testing)

#### 5.1 E2Eテスト拡充
- [ ] ユーザーシナリオテスト
- [ ] PostgreSQLモードE2Eテスト
- [ ] クロスブラウザテスト（Chrome, Firefox, Edge）
- [ ] モバイルレスポンシブテスト

#### 5.2 負荷テスト
- [ ] 同時接続テスト
- [ ] データ量増加テスト
- [ ] レスポンス時間計測

#### 5.3 セキュリティテスト
- [ ] 脆弱性スキャン
- [ ] 認証・認可テスト
- [ ] SQLインジェクションテスト

### Phase B-15: 本番移行 (Production Deployment)

#### 6.1 本番環境構築
- [ ] サーバープロビジョニング
- [ ] PostgreSQL本番設定
- [ ] Nginx本番設定
- [ ] SSL証明書設定

#### 6.2 データ移行実行
- [ ] 本番データ移行
- [ ] 整合性検証
- [ ] ロールバック手順確認

#### 6.3 運用開始
- [ ] 監視設定
- [ ] アラート設定
- [ ] ログローテーション設定
- [ ] バックアップスケジュール設定

---

## 3. 優先度別タスク一覧

### 最優先 (今日中)
1. ダミーデータ削除・空データ表示対応
2. HTTPS/SSL証明書設定
3. DB構造設計ドキュメント作成

### 高優先 (今週中)
4. Claude Code用プロンプトテンプレート整備
5. データ移行スクリプト作成
6. E2Eテスト拡充

### 中優先 (来週)
7. Microsoft 365連携調査
8. 負荷テスト実施
9. 運用ドキュメント完成

---

## 4. 技術スタック確認

### 本番環境
- OS: Ubuntu 24.04 LTS
- Python: 3.12+
- Database: PostgreSQL 16.11
- Web Server: Nginx + Gunicorn
- Service Manager: systemd

### セキュリティ対策済み
- JWT認証（Flask-JWT-Extended）
- CSRF対策（SameSite Cookie）
- XSS対策（DOM API使用）
- セキュアヘッダー（CSP, HSTS）
- パスワードポリシー実装

---

## 5. 次のアクション

1. **DB構造設計書作成** - 論理/物理モデル文書化
2. **ダミーデータ対応** - フラグ付け・削除・空表示
3. **SSL証明書設定** - 自己署名証明書生成とNginx設定
