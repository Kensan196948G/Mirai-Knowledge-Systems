# 建設土木ナレッジシステム 全体開発計画書

## 📋 プロジェクト概要

### 目的
施工計画・品質・安全・原価・出来形の知見を統合し、現場判断の速度と品質を高める建設土木会社向けナレッジ管理システムの開発

### 開発方針
1. **段階的開発**: プロトタイプ → 本番環境の順で段階的に実装
2. **品質重視**: 各フェーズでレビュー評価（数値化）を実施
3. **実用性優先**: 現場で即座に使える機能から優先実装

---

## 🎯 開発フェーズ全体像

### Phase A: プロトタイプ開発環境（全8フェーズ）✅ 完了

| フェーズ | 名称 | 状態 | 完了日 |
|---------|------|------|--------|
| A-1 | スコープ・課題定義 | ✅ 完了 | 2025-12-26 |
| A-2 | 情報設計・ナビゲーション設計 | ✅ 完了 | 2025-12-26 |
| A-3 | ワイヤーフレーム作成 | ✅ 完了 | 2025-12-26 |
| A-4 | ビジュアル設計・コンポーネント定義 | ✅ 完了 | 2025-12-26 |
| A-5 | 静的WebUI実装 | ✅ 完了 | 2025-12-26 |
| A-6 | 主要インタラクション実装 | ✅ 完了 | 2025-12-26 |
| A-7 | シナリオ検証・レビュー評価 | ✅ 完了 | 2025-12-26 |
| A-8 | 改善反映・本番移行要件整理 | ✅ 完了 | 2025-12-26 |

**総合評価**: 全シナリオ20点以上で合格 ✅

---

### Phase B: 本番環境開発（全11フェーズ）✅ 完了

| フェーズ | 名称 | 状態 | 完了日 |
|---------|------|------|--------|
| B-1 | 本番要件確定 | ✅ 完了 | 2025-12-27 |
| B-2 | アーキテクチャ設計確定 | ✅ 完了 | 2025-12-28 |
| B-3 | データ設計確定 | ✅ 完了 | 2025-12-29 |
| B-4 | API設計確定 | ✅ 完了 | 2025-12-30 |
| B-5 | バックエンド基盤実装 | ✅ 完了 | 2026-01-05 |
| B-6 | 検索・通知機能実装 | ✅ 完了 | 2026-01-06 |
| B-7 | WebUI統合実装 | ✅ 完了 | 2026-01-06 |
| B-8 | セキュリティ/権限/監査強化 | ✅ 完了 | 2026-01-06 |
| B-9 | 品質保証・受入テスト | ✅ 完了 | 2026-01-07 |
| B-10 | PostgreSQL移行 | ✅ 完了 | 2026-01-07 |
| B-11 | 本番準備（SSL/E2E） | ✅ 完了 | 2026-01-07 |

**成果**: テスト538件PASS、カバレッジ91%、PostgreSQL 16.11本番稼働

---

### Phase E: クロスプラットフォーム対応（全4フェーズ）✅ 完了

| フェーズ | 名称 | 状態 | 完了日 |
|---------|------|------|--------|
| E-1 | Node.jsモジュールOS分離 | ✅ 完了 | 2026-01-17 |
| E-2 | WebUIタイトル環境表示 | ✅ 完了 | 2026-01-17 |
| E-3 | 本番環境空状態表示 | ✅ 完了 | 2026-01-17 |
| E-4 | systemdサービス分離 | ✅ 完了 | 2026-01-17 |

**成果**: Windows/Linux両環境での開発・本番運用が可能

---

## 📊 現在の実装状況（2026-01-17時点）

### ✅ 完了済み

#### バックエンド
- Flask APIサーバー基盤（app_v2.py: 2,356行、27エンドポイント）
- RESTful APIエンドポイント
  - ナレッジ管理 (CRUD)
  - SOP管理 (CRUD)
  - 法令管理 (CRUD)
  - 事故レポート管理 (CRUD)
  - 専門家相談 (CRUD)
  - 承認フロー (承認/却下)
  - ダッシュボード統計
  - 監査ログAPI
  - ヘルスチェックAPI
- PostgreSQL 16.11（本番環境）
- JSONデータストレージ（開発環境）
- CORS対応（ネットワークアクセス可能）
- JWT認証 + パスワードポリシー
- CSRF対策

#### フロントエンド
- ダッシュボード画面（index.html）
- 詳細画面（5画面）
- 管理画面（admin.html）
- 動的データ表示 + 空状態表示
- 検索機能 + ページネーション + 履歴
- タブ切替
- 新規登録機能
- 環境表示（[開発]/[本番]タイトル）

#### インフラ
- systemdサービス（開発/本番分離）
- Nginx + Gunicorn
- SSL/HTTPS対応（自己署名証明書）
- クロスプラットフォーム対応（Windows/Linux）

#### 品質保証
- テスト538件PASS
- カバレッジ91%達成
- セキュリティスキャン（Bandit + Safety）
- E2Eテスト環境（Playwright + Chromium）
- 負荷テスト完了（82 req/sec、成功率100%）

#### ドキュメント
- 要件定義書
- 機能設計書
- UI/UX設計書
- データモデル
- 開発計画書（13カテゴリ、50ファイル以上）
- 運用手順書（Runbook）

### 📋 今後の予定（オプション）

- **Phase C: 本番運用開始**
  - 本番データ移行
  - ユーザートレーニング
  - 運用監視体制構築

- **Phase D: 機能拡張**
  - Microsoft 365連携（SharePoint/OneDrive）
  - 2要素認証
  - モバイルアプリ対応
  - 全文検索エンジン統合（Elasticsearch等）

---

## 🎯 Phase B-1: 本番要件確定（詳細）

### 目的
プロトタイプで検証した内容を元に、本番に必要な機能・非機能要件を確定する

### 実施内容

#### 1. 機能要件の確定 ✅

**高優先度（Phase B-5までに実装）**
- [x] ナレッジ検索・閲覧（基本実装済み）
- [x] 承認フロー可視化（基本実装済み）
- [x] 役割ベースアクセス制御（RBAC）
- [x] 監査ログ記録
- [ ] 検索条件の保持・履歴管理
- [ ] 関連ナレッジの自動提示

**中優先度（Phase B-6で実装）**
- [ ] 全文検索の高速化
- [ ] 通知配信（メール/チャット）
- [ ] ナレッジ推薦機能
- [ ] ダッシュボードのリアルタイム更新

**低優先度（Phase B-7以降）**
- [ ] モバイル対応の最適化
- [ ] オフライン閲覧機能
- [ ] AIによるナレッジ分類支援
- [ ] 3Dモデル連携

#### 2. 非機能要件の具体化 ✅

| 要件カテゴリ | 目標値 | 現状 | ギャップ |
|-------------|-------|------|---------|
| **性能** | | | |
| 主要画面表示 | 3秒以内 | 1秒程度 | ✅ 達成 |
| 検索応答 | 2秒以内 | 1秒以内 | ✅ 達成 |
| 同時接続数 | 300名 | 未検証 | 要検証 |
| **可用性** | | | |
| 月間稼働率 | 99.5%以上 | 未測定 | 要構築 |
| RTO（復旧時間） | 4時間 | 未定義 | 要構築 |
| RPO（データ損失） | 24時間 | 未定義 | 要構築 |
| **セキュリティ** | | | |
| 通信暗号化 | TLS 1.2以上 | HTTP | 要実装 |
| 認証方式 | SSO/LDAP | なし | 要実装 |
| 権限管理 | RBAC | なし | 要実装 |
| **監査** | | | |
| 操作ログ保管 | 7年間 | なし | 要実装 |
| 配信履歴保管 | 5年間 | なし | 要実装 |

#### 3. 前提・依存関係の整理 ✅

**依存する外部システム**
- メールサーバー（通知配信用）
- チャット/コラボレーションツール（Slack/Teams等）
- 認証基盤（SSO/LDAP）
- バックアップシステム

**必要なマスタデータ**
- 工種マスタ
- 工区マスタ
- 発注者マスタ
- 組織・部門マスタ
- ユーザー・権限マスタ

**既存データ移行**
- 既存SOP（56件想定）
- 法令・規格（24件想定）
- 過去の事故レポート
- 施工計画書・ナレッジ

---

## 📈 KPI・成功指標

### プロジェクトKPI

| 指標 | 目標値 | 測定方法 |
|-----|-------|---------|
| ナレッジ再利用率 | 70%以上 | 検索→閲覧→引用の追跡 |
| 事故ゼロ継続日数 | 維持 | 事故レポート登録なし日数 |
| 承認リードタイム短縮 | 30%短縮 | 申請→承認完了の時間 |
| 重要ナレッジ周知 | 48時間以内 | 配信→全員既読の時間 |

### 開発プロセスKPI

| 指標 | 目標値 |
|-----|-------|
| 各フェーズレビュー評価 | 20点以上/25点満点 |
| コードカバレッジ | 80%以上 |
| バグ密度 | 0.5件/KLOC以下 |
| システム稼働率 | 99.5%以上 |

---

## 🚀 Next Actions（直近のアクション）

### Phase C: 本番運用開始に向けて

1. **本番データ移行** 📊
   - 既存SOP、法令、事故レポートの移行
   - ユーザーマスタ、組織マスタの登録

2. **ユーザートレーニング** 📚
   - 管理者向け操作研修
   - 一般ユーザー向けマニュアル配布

3. **運用監視体制構築** 📈
   - Prometheus + Grafana設定
   - アラート通知設定
   - 定期バックアップ確認

### Phase D: 機能拡張（オプション）

1. **Microsoft 365連携** ☁️
   - Azure AD認証
   - SharePoint/OneDriveファイル連携

2. **2要素認証（MFA）** 🔐
   - TOTP対応
   - バックアップコード

3. **モバイル対応** 📱
   - レスポンシブUI最適化
   - PWA化検討

---

## 📝 レビュー評価基準（フェーズB-1）

| 観点 | 評価項目 | 配点 |
|-----|---------|-----|
| **完成度** | 要件が具体的で実装可能なレベルまで定義されているか | 5点 |
| **一貫性** | 要件間に矛盾がなく、優先度が明確か | 5点 |
| **実現性** | 技術的に実現可能で、リソース内で完了できるか | 5点 |
| **リスク** | リスクが特定され、対策が計画されているか | 5点 |
| **受入準備** | 受入基準が明確で、テスト計画の土台ができているか | 5点 |

**合格基準**: 20点以上/25点満点

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 担当 |
| --- | --- | --- | --- |
| 2026-01-17 | 2.0 | Phase B完了・Phase E完了を反映、クロスプラットフォーム対応 | Claude Code |
| 2026-01-07 | 1.5 | Phase B-8〜B-11完了を反映、本番準備完了 | Claude Code |
| 2025-12-26 | 1.0 | 初版作成、Phase A完了・Phase B開始を反映 | System |
