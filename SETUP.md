# セットアップガイド

建設土木ナレッジシステムのセットアップ手順を説明します。

## 📋 目次

1. [システム要件](#システム要件)
2. [インストール手順](#インストール手順)
3. [起動方法](#起動方法)
4. [動作確認](#動作確認)
5. [トラブルシューティング](#トラブルシューティング)

## システム要件

### 必須環境
- **OS**: Windows 10/11, macOS, Linux
- **Python**: 3.8以上
- **ブラウザ**: Chrome 90+, Firefox 88+, Edge 90+

### 推奨環境
- **メモリ**: 4GB以上
- **ディスク空間**: 500MB以上

## インストール手順

### ステップ1: Pythonのインストール確認

コマンドプロンプト（またはターミナル）を開いて、以下のコマンドを実行します：

```bash
python --version
```

Python 3.8以上がインストールされていることを確認してください。

**Pythonがインストールされていない場合:**
- [Python公式サイト](https://www.python.org/downloads/)からダウンロードしてインストールしてください
- インストール時に「Add Python to PATH」にチェックを入れてください

### ステップ2: プロジェクトディレクトリへ移動

```bash
cd Z:\Mirai-Knowledge-Systems
```

### ステップ3: 依存パッケージのインストール

```bash
cd backend
pip install -r requirements.txt
```

**エラーが発生した場合:**
- `pip`を最新版にアップグレード: `python -m pip install --upgrade pip`
- 再度インストールを試してください

### ステップ4: データディレクトリの確認

`backend/data/` ディレクトリに以下のファイルが存在することを確認します：
- `knowledge.json`
- `sop.json`
- `regulations.json`
- `incidents.json`
- `consultations.json`
- `approvals.json`

これらのファイルは初期データとして既に配置されています。

## 起動方法

### 開発サーバーの起動

`backend` ディレクトリで以下のコマンドを実行します：

```bash
python app.py
```

以下のような出力が表示されれば成功です：

```
============================================================
建設土木ナレッジシステム - サーバー起動中
============================================================
アクセスURL: http://localhost:5000
============================================================
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://0.0.0.0:5000
```

### 環境変数（任意）

- `MKS_JWT_SECRET_KEY`: JWTの秘密鍵（未設定時は開発用の値）
- `MKS_DATA_DIR`: JSONデータの保存先ディレクトリ
- `MKS_DEBUG`: デバッグモード（`true`/`false`）

### ブラウザでアクセス

ブラウザを開いて、以下のURLにアクセスします：

```
http://localhost:5000
```

ダッシュボード画面が表示されれば成功です！

## 動作確認

### 基本機能のテスト

#### 1. ダッシュボードの確認
- メトリクスカード（ナレッジ再利用率、事故ゼロ継続日数など）が表示されていることを確認
- 承認フロー一覧が表示されていることを確認

#### 2. 検索機能のテスト
1. 検索ボックスに「温度」と入力
2. 検索ボタンをクリック
3. 検索結果タブに関連するナレッジが表示されることを確認

#### 3. タブ切替のテスト
1. 「標準施工」タブをクリック
2. SOP一覧が表示されることを確認
3. 「事故・ヒヤリ」タブをクリック
4. 事故レポート一覧が表示されることを確認

#### 4. 新規登録のテスト
1. 画面右上の「新規ナレッジ登録」ボタンをクリック
2. タイトル、概要、カテゴリを入力
3. 登録完了のメッセージが表示されることを確認
4. 検索結果タブに新しいナレッジが表示されることを確認

### API動作確認

ブラウザの開発者ツール（F12キー）のコンソールを開き、以下のようなログが表示されていることを確認：

```
建設土木ナレッジシステム - 初期化中...
初期化完了！
```

エラーが表示されていないことを確認してください。

## トラブルシューティング

### ポート5000が既に使用されている

**エラーメッセージ:**
```
Address already in use
```

**解決方法:**

#### 方法1: ポートを変更する
`backend/app.py` の最後の行を編集：
```python
app.run(host='0.0.0.0', port=5001, debug=True)  # 5000 → 5001に変更
```

その後、`http://localhost:5001` でアクセスしてください。

#### 方法2: 使用中のプロセスを終了する

**Windows:**
```bash
netstat -ano | findstr :5000
taskkill /PID <プロセスID> /F
```

**macOS/Linux:**
```bash
lsof -i :5000
kill -9 <PID>
```

### モジュールが見つからないエラー

**エラーメッセージ:**
```
ModuleNotFoundError: No module named 'flask'
```

**解決方法:**
```bash
pip install -r requirements.txt
```

それでも解決しない場合、仮想環境を作成してください：

**Windows:**
```bash
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

**macOS/Linux:**
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### CORS エラー

**エラーメッセージ（ブラウザコンソール）:**
```
Access to fetch at 'http://localhost:5000/api/...' has been blocked by CORS policy
```

**解決方法:**
- `backend/app.py` で `Flask-CORS` が正しくインストールされていることを確認
- サーバーを再起動してください

### データが表示されない

**確認事項:**
1. サーバーが正常に起動しているか確認
2. ブラウザのコンソールにエラーがないか確認
3. `backend/data/` ディレクトリにJSONファイルが存在するか確認
4. JSONファイルの形式が正しいか確認（JSONバリデータで検証）

### ブラウザキャッシュの問題

**解決方法:**
- ブラウザのキャッシュをクリア（Ctrl+Shift+Delete）
- スーパーリロード（Ctrl+Shift+R または Ctrl+F5）

## 開発モードでの起動

デバッグモードを有効にしている場合、コードを変更すると自動的にサーバーが再起動します。

変更を加えた後は、ブラウザをリロードしてください。

## 本番環境への移行

本番環境では以下の設定変更が必要です：

1. `app.py` のデバッグモードを無効化：
   ```python
   app.run(host='0.0.0.0', port=5000, debug=False)
   ```

2. 本番用WSGIサーバー（Gunicornなど）の使用を推奨

3. データベースへの移行（現在はJSON、本番ではPostgreSQL等を推奨）

4. HTTPS対応

5. 認証・認可の実装

## サポート

問題が解決しない場合は、以下の情報を添えてお問い合わせください：

- OSとバージョン
- Pythonのバージョン
- エラーメッセージの全文
- 実行したコマンド
- ブラウザの種類とバージョン

---

**Happy Coding! 🚀**
